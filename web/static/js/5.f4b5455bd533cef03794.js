webpackJsonp([5],{XdGL:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l("mvHQ"),r=l.n(a),i=l("BO1k"),n=l.n(i),o=l("fZjL"),s=l.n(o),u=l("ttBl"),c={name:"pcr-calendar",data:function(){var e=this.$botApi,t={};return e.map(function(e){t[e]={private:[],group:[]}}),{botApi:e,setting:{},loading:!0,saveLoading:!1,testLoading:!1,testForm:{url:"",json:""},testVisible:!1,ruleVisible:!1,ruleForm:{on:!1,title:"",type:"",name:"",time:{},filter:[],push_list:t,needFlush:!1},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],type:[{required:!0,message:"请选择推送类型",trigger:"blur"}],name:[{required:!0,message:"请输入键名",trigger:"blur"}],time:[{validator:function(e,t,l){var a=s()(t);if(a.length>0){var r=!1,i=!0,o=!1,u=void 0;try{for(var c,m=n()(a);!(i=(c=m.next()).done);i=!0)t[c.value].length>0&&(r=!0)}catch(e){o=!0,u=e}finally{try{!i&&m.return&&m.return()}finally{if(o)throw u}}r?l():l(new Error("请输入至少一个"))}else l(new Error("请选择至少一个"))},trigger:"change"}]},addLoading:!1}},computed:{isAdmin:function(){return this.$store.state.isAdmin}},methods:{timeCheck:function(e,t,l,a){var i=JSON.parse(r()(this.setting));e?i.rules[l].time[a]=[]:delete i.rules[l].time[a],this.setting=i},formTimeCheck:function(e,t,l){var a=JSON.parse(r()(this.ruleForm));e?a.time[l]=[]:delete a.time[l],this.ruleForm=a},save:function(){var e=this;this.saveLoading=!0,u.d(this.setting).then(function(t){e.saveLoading=!1,e.$message({type:0===t.code?"success":"error",message:t.msg})}).catch(function(){e.saveLoading=!1})},urlTest:function(e,t){var l=this;""!==e&&(this.testLoading=!0,u.a(e,t).then(function(t){l.testLoading=!1,0===t.code?(l.testVisible=!0,l.testForm={url:e,json:r()(t.data,null,4)}):l.$message.error(t.msg)}).catch(function(){l.testLoading=!1}))},initRuleForm:function(){var e={};this.botApi.map(function(t){e[t]={private:[],group:[]}}),this.ruleForm={on:!1,title:"",type:"",name:"",time:{},filter:[],push_list:e,needFlush:!1},this.$refs.ruleForm.clearValidate()},ruleAdd:function(){var e=this;this.addLoading=!0,this.$refs.ruleForm.validate(function(t){e.addLoading=!1,t&&(e.setting.rules.push(e.ruleForm),e.ruleVisible=!1)})},ruleDel:function(e){this.setting.rules.splice(e,1)}},created:function(){var e=this;this.loading=!0,u.c().then(function(t){e.loading=!1,0===t.code&&(e.setting=t.data)}).catch(function(){})}},m={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{padding:"5px 0 0 0"}},[e.isAdmin?l("el-row",{staticStyle:{"margin-bottom":"15px"}},[l("el-button",{attrs:{size:"small",type:"primary",loading:e.saveLoading},on:{click:e.save}},[e._v("保存本页")])],1):e._e(),e._v(" "),e.loading?e._e():l("el-form",{attrs:{"label-width":"100px"}},[l("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"获取源"}},e._l(e.setting.calendar_source,function(t,a,r){return l("xm-info-box",{key:r,attrs:{title:t.title,retractable:"",retract:""}},[l("el-form",{attrs:{"label-width":"80px"}},[l("el-form-item",{attrs:{label:"源URL"}},[l("el-input",{attrs:{readonly:!e.isAdmin},model:{value:t.url,callback:function(l){e.$set(t,"url",l)},expression:"item.url"}},[l("el-button",{attrs:{slot:"append",icon:"el-icon-s-promotion",loading:e.testLoading},on:{click:function(l){return e.urlTest(t.url,t.needProxy)}},slot:"append"},[e._v("测试\n              ")])],1)],1),e._v(" "),l("el-form-item",{attrs:{label:"使用代理"}},[l("el-switch",{attrs:{"active-color":"#13ce66",disabled:!e.isAdmin},model:{value:t.needProxy,callback:function(l){e.$set(t,"needProxy",l)},expression:"item['needProxy']"}})],1),e._v(" "),l("xm-info-box",{staticStyle:{"margin-top":"7px"},attrs:{title:"键名"}},[l("div",{staticClass:"prop-box"},[l("span",{staticClass:"prop-label"},[e._v("活动名称")]),e._v(" "),l("el-input",{staticClass:"prop-value",attrs:{size:"small",readonly:!e.isAdmin},model:{value:t.props.name,callback:function(l){e.$set(t.props,"name",l)},expression:"item.props.name"}})],1),e._v(" "),l("div",{staticClass:"prop-box"},[l("span",{staticClass:"prop-label"},[e._v("开始时间")]),e._v(" "),l("el-input",{staticClass:"prop-value",attrs:{size:"small",readonly:!e.isAdmin},model:{value:t.props.start_time,callback:function(l){e.$set(t.props,"start_time",l)},expression:"item.props['start_time']"}})],1),e._v(" "),l("div",{staticClass:"prop-box"},[l("span",{staticClass:"prop-label"},[e._v("结束时间")]),e._v(" "),l("el-input",{staticClass:"prop-value",attrs:{size:"small",readonly:!e.isAdmin},model:{value:t.props.end_time,callback:function(l){e.$set(t.props,"end_time",l)},expression:"item.props['end_time']"}})],1)])],1)],1)}),1),e._v(" "),l("el-form-item",{attrs:{label:"默认区服"}},[l("el-select",{attrs:{disabled:!e.isAdmin},model:{value:e.setting.default_area,callback:function(t){e.$set(e.setting,"default_area",t)},expression:"setting['default_area']"}},e._l(e.setting.calendar_source,function(e,t,a){return l("el-option",{key:a,attrs:{label:e.title,value:t}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{label:"推送列表"}},e._l(e.setting.push_list,function(t,a,r){return l("xm-info-box",{key:r,staticStyle:{"padding-top":"20px"},attrs:{retractable:"",title:String(a).toUpperCase()}},[l("xm-info-box",{attrs:{title:"群组",retractable:"",retract:0===t.group.length}},[l("xm-tags",{attrs:{disabled:!e.isAdmin,value:t.group,label:"Group"},on:{"update:value":function(l){return e.$set(t,"group",l)}}})],1),e._v(" "),l("xm-info-box",{attrs:{title:"私聊",retractable:"",retract:0===t.private.length}},[l("xm-tags",{attrs:{disabled:!e.isAdmin,value:t.private,label:"Private"},on:{"update:value":function(l){return e.$set(t,"private",l)}}})],1)],1)}),1),e._v(" "),l("el-form-item",[l("span",{attrs:{slot:"label"},slot:"label"},[l("span",{staticClass:"icon-new-label"},[e._v("推送规则")]),e._v(" "),e.isAdmin?l("i",{staticClass:"el-icon-circle-plus-outline icon-new-button",on:{click:function(t){e.ruleVisible=!0}}}):e._e()]),e._v(" "),e._l(e.setting.rules,function(t,a){return l("xm-info-box",{key:a,attrs:{title:t.title,retractable:"",retract:"",editable:""}},[e.isAdmin?l("div",{staticClass:"tool-btn"},[l("el-tooltip",{attrs:{content:"删除",placement:"left"}},[l("el-link",{attrs:{type:"danger"},on:{click:function(t){return e.ruleDel(a)}}},[l("i",{staticClass:"el-icon-delete-solid"})])],1)],1):e._e(),e._v(" "),l("el-form",{attrs:{"label-width":"80px"}},[l("el-form-item",{staticClass:"display-inline-block",staticStyle:{"margin-right":"20px"},attrs:{label:"开启"}},[l("el-switch",{attrs:{disabled:!e.isAdmin,"active-color":"#13ce66"},model:{value:t.on,callback:function(l){e.$set(t,"on",l)},expression:"item.on"}})],1),e._v(" "),l("el-form-item",{staticClass:"display-inline-block",attrs:{label:"刷新日历"}},[l("el-switch",{attrs:{disabled:!e.isAdmin,"active-color":"#13ce66"},model:{value:t.needFlush,callback:function(l){e.$set(t,"needFlush",l)},expression:"item.needFlush"}})],1),e._v(" "),l("el-form-item",{staticClass:"display-inline-block",attrs:{label:"键名"}},[l("el-input",{staticStyle:{width:"160px"},attrs:{readonly:""},model:{value:t.name,callback:function(l){e.$set(t,"name",l)},expression:"item.name"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"关键词"}},[l("xm-tags",{attrs:{disabled:!e.isAdmin,type:"info",value:t.filter,label:"Filter"},on:{"update:value":function(l){return e.$set(t,"filter",l)}}})],1),e._v(" "),l("el-form-item",{attrs:{label:"推送类型"}},[l("el-select",{staticStyle:{width:"120px"},attrs:{disabled:!e.isAdmin,size:"small"},model:{value:t.type,callback:function(l){e.$set(t,"type",l)},expression:"item.type"}},[l("el-option",{attrs:{value:"yesterday",label:"昨日活动"}}),e._v(" "),l("el-option",{attrs:{value:"today",label:"今日活动"}}),e._v(" "),l("el-option",{attrs:{value:"tomorrow",label:"明日活动"}}),e._v(" "),l("el-option",{attrs:{value:"lastWeek",label:"上周活动"}}),e._v(" "),l("el-option",{attrs:{value:"thisWeek",label:"本周活动"}}),e._v(" "),l("el-option",{attrs:{value:"nextWeek",label:"下周活动"}})],1)],1),e._v(" "),l("el-form-item",{staticStyle:{"margin-top":"10px"},attrs:{label:"推送"}},e._l(t.push_list,function(t,a,r){return l("xm-info-box",{key:r,staticStyle:{"padding-top":"20px"},attrs:{retractable:"",title:String(a).toUpperCase()}},[l("xm-info-box",{attrs:{title:"群聊",retractable:""}},[l("el-checkbox",{attrs:{disabled:!e.isAdmin,checked:"all"===t.group},on:{change:function(e){t.group=e?"all":[]}}},[e._v("全局推送\n                ")]),e._v(" "),"all"!==t.group?l("xm-tags",{attrs:{disabled:!e.isAdmin,value:t.group,label:"Group"},on:{"update:value":function(l){return e.$set(t,"group",l)}}}):e._e()],1),e._v(" "),l("xm-info-box",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"私聊",retractable:""}},[l("el-checkbox",{attrs:{disabled:!e.isAdmin,checked:"all"===t.private},on:{change:function(e){t.private=e?"all":[]}}},[e._v("全局推送\n                ")]),e._v(" "),"all"!==t.private?l("xm-tags",{attrs:{disabled:!e.isAdmin,value:t.private,label:"Private"},on:{"update:value":function(l){return e.$set(t,"private",l)}}}):e._e()],1)],1)}),1),e._v(" "),l("xm-info-box",{staticStyle:{margin:"10px 0 10px 0"},attrs:{title:"推送时间",retractable:"",retract:""}},[l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("year"),label:"年",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"year")}}}),e._v(" "),t.time.year?l("xm-tags",{attrs:{value:t.time.year,label:"Year",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"year",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("month"),label:"月",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"month")}}}),e._v(" "),t.time.month?l("xm-tags",{attrs:{value:t.time.month,label:"Month",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"month",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("date"),label:"日",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"date")}}}),e._v(" "),t.time.date?l("xm-tags",{attrs:{value:t.time.date,label:"Date",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"date",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("dayOfWeek"),label:"星期",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"dayOfWeek")}}}),e._v(" "),t.time.dayOfWeek?l("xm-tags",{attrs:{value:t.time.dayOfWeek,label:"DayOfWeek",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"dayOfWeek",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("hour"),label:"时",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"hour")}}}),e._v(" "),t.time.hour?l("xm-tags",{attrs:{value:t.time.hour,label:"Hour",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"hour",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("minute"),label:"分",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"minute")}}}),e._v(" "),t.time.minute?l("xm-tags",{attrs:{value:t.time.minute,label:"Minute",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"minute",l)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:t.time.hasOwnProperty("second"),label:"秒",disabled:!e.isAdmin},on:{change:function(l){return e.timeCheck(l,t,a,"second")}}}),e._v(" "),t.time.second?l("xm-tags",{attrs:{value:t.time.second,label:"Second",disabled:!e.isAdmin},on:{"update:value":function(l){return e.$set(t.time,"second",l)}}}):e._e()],1)],1)],1)],1)})],2)],1),e._v(" "),l("el-dialog",{attrs:{visible:e.testVisible,title:e.testForm.url,center:"","close-on-click-modal":!1},on:{"update:visible":function(t){e.testVisible=t},closed:function(t){e.testForm={url:"",json:""}}}},[l("el-collapse",[l("el-collapse-item",{attrs:{title:"JSON"}},[l("pre",{staticStyle:{"max-height":"500px",overflow:"auto"}},[e._v("          "+e._s(e.testForm.json)+"\n        ")])])],1)],1),e._v(" "),l("el-dialog",{attrs:{visible:e.ruleVisible,title:"新增推送规则",center:"","close-on-click-modal":!1},on:{"update:visible":function(t){e.ruleVisible=t},closed:e.initRuleForm}},[l("el-form",{ref:"ruleForm",attrs:{"label-width":"90px",model:e.ruleForm,rules:e.rules}},[l("el-form-item",{attrs:{label:"标题",prop:"title"}},[l("el-input",{attrs:{placeholder:"请输入标题"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),l("el-form-item",{staticClass:"display-inline-block",staticStyle:{"margin-right":"20px"},attrs:{label:"开启",prop:"on"}},[l("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.ruleForm.on,callback:function(t){e.$set(e.ruleForm,"on",t)},expression:"ruleForm.on"}})],1),e._v(" "),l("el-form-item",{staticClass:"display-inline-block",attrs:{label:"刷新日历",prop:"needFlush"}},[l("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.ruleForm.needFlush,callback:function(t){e.$set(e.ruleForm,"needFlush",t)},expression:"ruleForm.needFlush"}})],1),e._v(" "),l("el-form-item",{staticClass:"display-inline-block",attrs:{label:"键名",prop:"name"}},[l("el-input",{staticStyle:{width:"160px"},attrs:{placeholder:"请输入键名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"关键词"}},[l("xm-tags",{attrs:{type:"info",value:e.ruleForm.filter,label:"Filter"},on:{"update:value":function(t){return e.$set(e.ruleForm,"filter",t)}}})],1),e._v(" "),l("el-form-item",{attrs:{label:"推送类型",prop:"type",placeholder:"请选择推送类型"}},[l("el-select",{staticStyle:{width:"120px"},attrs:{size:"small"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[l("el-option",{attrs:{value:"yesterday",label:"昨日活动"}}),e._v(" "),l("el-option",{attrs:{value:"today",label:"今日活动"}}),e._v(" "),l("el-option",{attrs:{value:"tomorrow",label:"明日活动"}}),e._v(" "),l("el-option",{attrs:{value:"lastWeek",label:"上周活动"}}),e._v(" "),l("el-option",{attrs:{value:"thisWeek",label:"本周活动"}}),e._v(" "),l("el-option",{attrs:{value:"nextWeek",label:"下周活动"}})],1)],1),e._v(" "),l("el-form-item",{staticStyle:{"margin-top":"25px"},attrs:{label:"推送"}},e._l(e.ruleForm.push_list,function(t,a,r){return l("xm-info-box",{key:r,staticStyle:{"padding-top":"20px"},attrs:{retractable:"",title:String(a).toUpperCase()}},[l("xm-info-box",{attrs:{title:"群聊",retractable:""}},[l("el-checkbox",{attrs:{checked:"all"===t.group},on:{change:function(e){t.group=e?"all":[]}}},[e._v("全局推送\n            ")]),e._v(" "),"all"!==t.group?l("xm-tags",{attrs:{value:t.group,label:"Group"},on:{"update:value":function(l){return e.$set(t,"group",l)}}}):e._e()],1),e._v(" "),l("xm-info-box",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"私聊",retractable:""}},[l("el-checkbox",{attrs:{checked:"all"===t.private},on:{change:function(e){t.private=e?"all":[]}}},[e._v("全局推送\n            ")]),e._v(" "),"all"!==t.private?l("xm-tags",{attrs:{value:t.private,label:"Private"},on:{"update:value":function(l){return e.$set(t,"private",l)}}}):e._e()],1)],1)}),1),e._v(" "),l("el-form-item",{attrs:{prop:"time","label-width":"0"}},[l("xm-info-box",{staticStyle:{margin:"10px 0 10px 0"},attrs:{title:"推送时间",retractable:"",retract:""}},[l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("year"),label:"年"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"year")}}}),e._v(" "),e.ruleForm.time.year?l("xm-tags",{attrs:{value:e.ruleForm.time.year,label:"Year"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"year",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("month"),label:"月"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"month")}}}),e._v(" "),e.ruleForm.time.month?l("xm-tags",{attrs:{value:e.ruleForm.time.month,label:"Month"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"month",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("date"),label:"日"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"date")}}}),e._v(" "),e.ruleForm.time.date?l("xm-tags",{attrs:{value:e.ruleForm.time.date,label:"Date"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"date",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("dayOfWeek"),label:"星期"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"dayOfWeek")}}}),e._v(" "),e.ruleForm.time.dayOfWeek?l("xm-tags",{attrs:{value:e.ruleForm.time.dayOfWeek,label:"DayOfWeek"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"dayOfWeek",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("hour"),label:"时"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"hour")}}}),e._v(" "),e.ruleForm.time.hour?l("xm-tags",{attrs:{value:e.ruleForm.time.hour,label:"Hour"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"hour",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("minute"),label:"分"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"minute")}}}),e._v(" "),e.ruleForm.time.minute?l("xm-tags",{attrs:{value:e.ruleForm.time.minute,label:"Minute"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"minute",t)}}}):e._e()],1),e._v(" "),l("el-row",[l("el-checkbox",{attrs:{checked:e.ruleForm.time.hasOwnProperty("second"),label:"秒"},on:{change:function(t){return e.formTimeCheck(t,e.ruleForm,"second")}}}),e._v(" "),e.ruleForm.time.second?l("xm-tags",{attrs:{value:e.ruleForm.time.second,label:"Second"},on:{"update:value":function(t){return e.$set(e.ruleForm.time,"second",t)}}}):e._e()],1)],1)],1)],1),e._v(" "),l("el-row",{staticClass:"text-center"},[l("el-button",{attrs:{size:"small",type:"primary",loading:e.addLoading},on:{click:e.ruleAdd}},[e._v("保存")]),e._v(" "),l("el-button",{attrs:{size:"small"},on:{click:function(t){e.ruleVisible=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var d=l("VU/8")(c,m,!1,function(e){l("dT5J")},"data-v-024d57b2",null);t.default=d.exports},dT5J:function(e,t){},ttBl:function(e,t,l){"use strict";l.d(t,"c",function(){return r}),l.d(t,"a",function(){return i}),l.d(t,"b",function(){return n}),l.d(t,"d",function(){return o});var a=l("gyMJ"),r=function(){return Object(a.b)({url:"/setting/calendar/pcr.json",method:"get"})},i=function(e,t){return Object(a.b)({url:"/calendar/url/test.do",method:"get",params:{url:e,needProxy:t}})},n=function(){return Object(a.b)({url:"/calendar/getAll.json",method:"get"})},o=function(e){return Object(a.b)({url:"/setting/calendar/pcr.save",method:"post",data:e})}}});
//# sourceMappingURL=5.f4b5455bd533cef03794.js.map