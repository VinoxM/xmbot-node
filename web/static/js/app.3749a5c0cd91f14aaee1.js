webpackJsonp([20],{Dod7:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i}),n.d(e,"c",function(){return a});var o=n("gyMJ"),r=function(){return Object(o.b)({url:"/setting/default.json",method:"get"})},i=function(){return Object(o.b)({url:"/getBotApi.json",method:"get"})},a=function(t){return Object(o.b)({url:"/setting/default.save",method:"post",data:t})}},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("7+uW"),r={name:"url-prefix-conf",data:function(){return{urlConf:this.$urlConf,baseUrlPrefix:"",urlShow:!1,settingShow:!1,rightShow:!1}},computed:{positionClass:function(){return this.settingShow?this.urlShow?"position-fixed right-10":this.rightShow?"position-fixed right-0":"position-fixed right-10":"position-fixed right-0"}},methods:{prefixChanged:function(t){this.updateBaseUrl(t),window.location.reload()},hide:function(){this.urlShow=!1,this.rightShow=!1},rightArrowShow:function(){this.rightShow=!0}},mounted:function(){var t=this.$cookies.get("curUrlPrefix");this.baseUrlPrefix=t||"base"}},i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.positionClass,on:{mouseleave:t.hide,mouseenter:t.rightArrowShow}},[n("span",{directives:[{name:"show",rawName:"v-show",value:!t.urlShow,expression:"!urlShow"}]},[t.settingShow?n("span",[n("el-tooltip",{attrs:{content:"url前缀设置",placement:"top"}},[n("i",{staticClass:"el-icon-setting setting-icon",on:{click:function(e){t.urlShow=!0}}})]),t._v(" "),n("i",{directives:[{name:"show",rawName:"v-show",value:t.rightShow,expression:"rightShow"}],staticClass:"el-icon-arrow-right setting-icon",on:{click:function(e){t.settingShow=!1}}})],1):n("span",[n("i",{staticClass:"el-icon-arrow-left setting-icon",on:{click:function(e){t.settingShow=!0}}})])]),t._v(" "),n("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.urlShow,expression:"urlShow"}],attrs:{size:"small"},on:{change:t.prefixChanged},model:{value:t.baseUrlPrefix,callback:function(e){t.baseUrlPrefix=e},expression:"baseUrlPrefix"}},[n("el-tooltip",{attrs:{content:"默认前缀:"+t.urlConf.base_url,placement:"top"}},[n("el-radio-button",{attrs:{label:"base"}},[t._v("base")])],1),t._v(" "),n("el-tooltip",{attrs:{content:"开发前缀:"+t.urlConf.dev_url,placement:"top"}},[n("el-radio-button",{attrs:{label:"dev"}},[t._v("dev")])],1),t._v(" "),n("el-tooltip",{attrs:{content:"服务器前缀:"+t.urlConf.pro_url,placement:"top"}},[n("el-radio-button",{attrs:{label:"pro"}},[t._v("pro")])],1)],1)],1)},staticRenderFns:[]};var a={name:"App",components:{"url-conf":n("VU/8")(r,i,!1,function(t){n("fOKU")},"data-v-1cf41455",null).exports},computed:{isAdmin:function(){return this.$store.state.isAdmin}},data:function(){return{}},created:function(){this.$cookies.get("user_id")}},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"text-left",attrs:{id:"app"}},[e("router-view"),this._v(" "),e("url-conf")],1)},staticRenderFns:[]};var s=n("VU/8")(a,c,!1,function(t){n("qX+1")},null,null).exports,u=n("YaEn"),l=n("zL8q"),d=n.n(l),p=(n("tvR6"),n("gyMJ")),h=n("ppUw"),f=n.n(h),m=n("Gu7T"),g=n.n(m),w=n("fZjL"),v=n.n(w),b=n("BO1k"),x=n.n(b),_=n("NYxO");o.default.use(_.a);var C=new _.a.Store({state:{isAdmin:!1,calendar_setting:{},chatLog:{private:{},group:{}}},mutations:{updateIsAdmin:function(t,e){t.isAdmin=e},updateCalendar:function(t,e){t.calendar_setting=e},flushChatLog:function(t,e){var n=!0,o=!1,r=void 0;try{for(var i,a=x()(["private","group"]);!(n=(i=a.next()).done);n=!0){var c=i.value;if(e.hasOwnProperty(c)){var s=!0,u=!1,l=void 0;try{for(var d,p=x()(v()(e[c]));!(s=(d=p.next()).done);s=!0){var h=d.value,f=e[c][h];t.chatLog[c].hasOwnProperty(h)||(t.chatLog[c][h]=f)}}catch(t){u=!0,l=t}finally{try{!s&&p.return&&p.return()}finally{if(u)throw l}}}}}catch(t){o=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}},pushChatLog:function(t,e){var n=e.tableName.split("_");t.chatLog[n[0]][n[1]+"_"+n[2]]?(t.chatLog[n[0]][n[1]+"_"+n[2]].rows.push(e),t.chatLog[n[0]][n[1]+"_"+n[2]].hasNew=!0,t.chatLog[n[0]][n[1]+"_"+n[2]].newCount++):t.chatLog[n[0]][n[1]+"_"+n[2]]={rows:[e],noMore:!1,hasNew:!0,newCount:1}},appendChatLog:function(t,e){var n=e.tableName.split("_");t.chatLog[n[0]][n[1]+"_"+n[2]]?(t.chatLog[n[0]][n[1]+"_"+n[2]].rows=[].concat(g()(e.rows),g()(t.chatLog[n[0]][n[1]+"_"+n[2]].rows)),t.chatLog[n[0]][n[1]+"_"+n[2]].noMore=e.rows.length<20):t.chatLog[n[0]][n[1]+"_"+n[2]]={rows:[e],noMore:!1,hasNew:!1}}}}),y=(n("PrDN"),void 0),$=void 0,k=0,L="pro",S={base:"ws://121.41.225.90:9220/",dev:"ws://127.0.0.1:9220/",pro:"ws://121.41.225.90:9220/"},j={send:function(t){return y.send(t)},close:function(){return y.close()},ready:!1,isConnecting:!1,connect:function(t){return A(t)}};function A(t){console.log(0===k?"ws connecting":"ws reconnection ["+k+" times]"),y&&y.close(),j.isConnecting=!0;var e=t.$cookies.get("curUrlPrefix"),n=S[e||L];y=new WebSocket(n),function(t){y.onopen=function(){j.isConnecting=!1,j.ready=!0,k=0,console.log("ws connected")},y.onerror=function(){j.isConnecting=!1,j.ready=!1,console.log("ws connect error"+(k<3?",reconnect in 2s later":",refresh page to reconnect"))},y.onclose=function(){console.log("ws closed"),j.isConnecting=!1,j.ready=!1,function(t){if(k++,j.isConnecting||j.ready||k>3)return;$&&clearTimeout($),$=setTimeout(function(){A(t)},2e3)}(t)},y.onmessage=function(e){var n=JSON.parse(e.data);switch(console.log(n),n.type){case"all":t.$store.commit("flushChatLog",n.data);break;case"elem":t.$store.commit("pushChatLog",n.data);break;case"more":t.$store.commit("appendChatLog",n.data)}}}(t)}var P=n("vO7p"),O=n.n(P),U=n("Dod7");o.default.component("xm-tags",function(){return n.e(7).then(n.bind(null,"30WY"))}),o.default.component("xm-info-box",function(){return n.e(16).then(n.bind(null,"eJXZ"))}),o.default.config.productionTip=!1,o.default.use(d.a),o.default.use(f.a),o.default.use(O.a),o.default.prototype.$ajax=p.b,o.default.prototype.$urlConf=p.e,o.default.prototype.$ws=j;var N=new o.default({router:u.d,store:C,components:{App:s},template:"<App/>"});o.default.prototype.checkAuth=function(){return Object(u.a)(N)},o.default.prototype.updateBaseUrl=function(t){Object(p.c)(t),N.$cookies.set("curUrlPrefix",t)},Object(p.a)(N),Object(p.c)(N.$cookies.get("curUrlPrefix")),Object(u.b)(N).then(function(){N.$store.commit("updateIsAdmin",!0)}).catch(function(){N.$store.commit("updateIsAdmin",!1)}),A(N),Object(U.b)().then(function(t){o.default.prototype.$botApi=t.data}),N.$mount("#app")},YaEn:function(t,e,n){"use strict";n.d(e,"c",function(){return c}),n.d(e,"d",function(){return u}),e.a=l,e.b=function(t,e){return new r.a(function(n,o){var r=e||t.$cookies.get("user_id");r?t.$ajax({url:"/checkIsAdmin.valid",params:{user_id:r}}).then(function(t){0===t.code?n():o()}).catch(function(t){o()}):o()})};var o=n("//Fk"),r=n.n(o),i=n("7+uW"),a=n("/ocq");i.default.use(a.a);var c=[{title:"基础设置",icon:"el-icon-setting",path:"/base-setting",name:"base-setting",component:function(){return n.e(13).then(n.bind(null,"MFx4"))}},{title:"帮助手册",icon:"el-icon-notebook-2",path:"/plugins-dict",name:"plugins-dict",component:function(){return n.e(6).then(n.bind(null,"OzDY"))}},{title:"复读设置",icon:"el-icon-printer",path:"/repeat-setting",name:"repeat-setting",component:function(){return n.e(17).then(n.bind(null,"fj0r"))}},{title:"Chat设置",icon:"el-icon-chat-round",path:"/chat-setting",name:"chat-setting",component:function(){return n.e(11).then(n.bind(null,"Z2No"))}},{title:"RSS设置",icon:"el-icon-paperclip",path:"/rss-setting",name:"rss-setting",component:function(){return Promise.all([n.e(10),n.e(0)]).then(n.bind(null,"qdI8"))}},{title:"Live设置",icon:"el-icon-video-play",path:"/live-setting",name:"live-setting",meta:{auth:!0,noAuthHidden:!0},component:function(){return n.e(3).then(n.bind(null,"YXiS"))}},{title:"Bili动态管理",icon:"el-icon-chat-round",path:"/bili-dynamic",name:"bili-dynamic",meta:{auth:!0,noAuthHidden:!0},component:function(){return n.e(2).then(n.bind(null,"Bnf9"))}},{title:"聊天人偶",icon:"el-icon-chat-line-square",path:"/chat-puppet",name:"chat-puppet",meta:{auth:!0,noAuthHidden:!0},component:function(){return n.e(15).then(n.bind(null,"LN0s"))}},{title:"PCR卡池设置",icon:"el-icon-s-custom",path:"/gacha/pcr/pool-setting",name:"pcr-pool-setting",meta:{auth:!1},component:function(){return Promise.all([n.e(1),n.e(0)]).then(n.bind(null,"DKKw"))}},{title:"PCR活动日历",icon:"el-icon-date",path:"/calendar-pcr",name:"calendar-pcr",component:function(){return n.e(4).then(n.bind(null,"Zv61"))}},{title:"PCR日历设置",icon:"el-icon-position",path:"/calendar-setting",name:"calendar-setting",component:function(){return Promise.all([n.e(5),n.e(0)]).then(n.bind(null,"XdGL"))}}],s=[{path:"/",redirect:"/index"},{path:"*",redirect:"/404"},{path:"/404",name:"404",component:function(){return n.e(8).then(n.bind(null,"thLP"))}},{path:"/index",name:"Index",component:function(){return n.e(12).then(n.bind(null,"dAjm"))},redirect:"/home",children:[{title:"首页",icon:"",path:"/home",name:"home",component:function(){return n.e(18).then(n.bind(null,"wUZA"))}}].concat(c)},{path:"/login",name:"login",component:function(){return n.e(14).then(n.bind(null,"s3nr"))}},{path:"/reset-pwd",name:"resetPassword",component:function(){return n.e(9).then(n.bind(null,"X+6L"))}}],u=new a.a({routes:s});function l(t){return new r.a(function(e,n){var o=t.$cookies.get("token"),r=t.$cookies.get("salt");o&&r?t.$ajax({url:"/token.valid",params:{token:o,salt:r}}).then(function(o){0===o.code?e():t.$message({type:"error",message:o.msg,duration:1e3,onClose:function(){n("/login")}})}).catch(function(t){n("/index")}):t.$message({type:"error",message:"未登录",duration:1e3,onClose:function(){n("/login")}})})}},fOKU:function(t,e){},gyMJ:function(t,e,n){"use strict";n.d(e,"b",function(){return l}),n.d(e,"e",function(){return d}),e.c=function(t){l.defaults.baseURL=d[(t||p)+"_url"]},e.a=function(t){var e=this;l.interceptors.request.use(function(e){var n=t.$cookies.get("salt"),o=t.$cookies.get("token"),r=t.$cookies.get("user_id");return e.headers.token=o||"",e.headers.salt=n||"",e.headers.user_id=r||"",e},function(e){return t.$message({type:"error",message:"请求出错"}),s.a.reject(e)}),l.interceptors.response.use(function(n){return 400===n.data.code||403===n.data.code?(t.$message({type:"error",message:n.data.msg,duration:1e3,onClose:(o=a()(r.a.mark(function n(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$router.push("/login");case 2:case"end":return e.stop()}},n,e)})),function(){return o.apply(this,arguments)})}),s.a.reject("")):n.data;var o},function(e){return t.$message({type:"error",message:"服务器出错"}),s.a.reject(e)})};var o=n("Xxa5"),r=n.n(o),i=n("exGp"),a=n.n(i),c=n("//Fk"),s=n.n(c),u=n("mw3O"),l=(n.n(u),n("mtWM").default),d={base_url:"/",dev_url:"http://127.0.0.1:9221/",pro_url:"http://121.4.130.205:9221/"},p="base";e.d=l},"qX+1":function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.3749a5c0cd91f14aaee1.js.map