{"version":3,"sources":["webpack:///src/components/others/socket-chat.vue","webpack:///./src/components/others/socket-chat.vue?195c","webpack:///./src/components/others/socket-chat.vue"],"names":["socket_chat","name","data","loading","imgSuffix","ws","textArea","altEnter","inputErr","activeTab","chatLog","curBox","height","scrollTop","scrollHeight","moreLoading","computed","ws_","this","$ws","chatLog_","$store","state","wsStatus","ready","isConnecting","wsColor","watch","val","handler","getChatLog","deep","changeCurBox","methods","wsConnect","connect","scrollChange","e","target","offsetHeight","contentScroll","flag","chatBox","document","getElementsByClassName","length","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","box","value","err","return","_this","chat","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","keys_default","group","key","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","private","_key","keys","some","o","_this2","$nextTick","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","dateFormat","d","date","Date","getFullYear","getMonth","getDate","String","getHours","padStart","getMinutes","getSeconds","msgFormat","message","msg","atS","indexOf","atStr","substring","atE","CQ","at","replace","curUrlPrefix","$cookies","get","urlPrefix","$urlConf","imgFormat","split","cqS","cqStr","cqE","urlS","urlStr","url","substr","sp","startsWith","fileS","fileStr","file","console","log","_url","replaceAll","sendSubmit","_this3","receiver","toLowerCase","reply","params","message_type","$ajax","method","then","res","sendInit","getMore","type","id","index","rows","created","_this4","$route","meta","auth","checkAuth","catch","$router","push","$destroy","$options","others_socket_chat","render","_vm","_h","$createElement","_c","_self","directives","rawName","expression","staticClass","attrs","on","click","_v","_s","_e","tab-position","model","callback","$$v","_l","label","$event","ref","refInFor","scroll","disabled","noMore","item","k","class","content","user_id","placement","domProps","innerHTML","placeholder","maxlength","show-word-limit","nativeOn","keypress","_k","keyCode","preventDefault","keydown","altKey","ctrlKey","size","icon","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/14.96cd15d9436d6aa14f2a.js","sourcesContent":["<template>\n  <div v-loading=\"loading\">\n    <el-row class=\"text-center chat-header\">\n      <el-link :type=\"wsColor\" @click=\"wsConnect\">{{wsStatus}}</el-link>\n    </el-row>\n    <div class=\"chat-divider\"></div>\n    <el-tabs tab-position=\"left\" v-if=\"!loading\" class=\"chat-box\" v-model=\"activeTab\">\n      <el-tab-pane v-for=\"(val,key,index) of chatLog\" :key=\"index\" :label=\"key\" class=\"chat-box-tabs\" :name=\"key\">\n        <div class=\"chat-box-scroll scroll-to-top\" v-show=\"curBox.scrollTop>200\" @click=\"contentScroll(true)\">\n          <i class=\"el-icon-caret-top\"></i>\n        </div>\n        <div class=\"chat-box-content\" ref=\"chatBox\" @scroll=\"scrollChange\">\n          <el-row class=\"chat-box-more\">\n            <el-link type=\"info\" @click=\"getMore\" :disabled=\"val.noMore\">\n              {{val.noMore?'没有更多':'加载更多'}}\n            </el-link>\n          </el-row>\n          <el-row v-for=\"(item,k) of val.rows\" :key=\"k\" :class=\"item['is_self']?'chat-box-row-self':'chat-box-row'\">\n            <div :class=\"item['is_self']?'chat-item-self':'chat-item'\">\n              <div :class=\"item['is_self']?'text-right chat-item-title':'chat-item-title'\">\n                <el-tooltip :content=\"item.user_id\" placement=\"top\">\n                  <el-link class=\"chat-item-user\">{{item['nick_name']}}</el-link>\n                </el-tooltip>\n                <span class=\"chat-item-time\"> [{{dateFormat(item['send_time'])}}]</span>\n              </div>\n              <p v-html=\"msgFormat(item.message)\" class=\"chat-item-content\"></p>\n            </div>\n          </el-row>\n        </div>\n        <div class=\"chat-box-scroll scroll-to-bottom\" v-show=\"curBox.scrollHeight-curBox.scrollTop > curBox.height+200\"\n             @click=\"contentScroll(false)\">\n          <i class=\"el-icon-caret-bottom\"></i>\n        </div>\n        <div class=\"chat-divider\"></div>\n        <div class=\"chat-box-input\">\n          <el-input type=\"textarea\" :rows=\"8\" placeholder=\"请输入内容\" v-model=\"textArea\" maxlength=\"250\" show-word-limit\n                    :class=\"inputErr?'chat-input-textarea border-err':'chat-input-textarea'\"\n                    @keypress.enter.native.prevent=\"sendSubmit\"\n                    @keydown.alt.enter.native=\"textArea += '\\n'\"\n                    @keydown.ctrl.enter.native=\"textArea += '\\n'\"\n          ></el-input>\n          <div class=\"chat-box-input-btn\">\n            <span class=\"chat-input-err\" v-show=\"inputErr\">未输入内容</span>\n            <el-button size=\"small\" icon=\"el-icon-delete\" @click=\"sendInit\">清空</el-button>\n            <el-button size=\"small\" type=\"primary\" icon=\"el-icon-check\" @click=\"sendSubmit\">发送</el-button>\n          </div>\n        </div>\n      </el-tab-pane>\n    </el-tabs>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: \"home\",\n    data() {\n      return {\n        loading: true,\n        imgSuffix: ['jpg', 'jpeg', 'png', 'gif'],\n        ws: {},\n        textArea: '',\n        altEnter: false,\n        inputErr: false,\n        activeTab: '',\n        chatLog: {},\n        curBox: {\n          height: 0,\n          scrollTop: 0,\n          scrollHeight: 0\n        },\n        moreLoading: false\n      }\n    },\n    computed: {\n      ws_() {\n        return this.$ws\n      },\n      chatLog_() {\n        return this.$store.state.chatLog\n      },\n      wsStatus() {\n        if (this.ws.ready) {\n          return '已连接到服务器'\n        } else if (this.ws.isConnecting) {\n          return '连接服务器中'\n        } else {\n          return '未连接到服务器'\n        }\n      },\n      wsColor(){\n        if (this.ws.ready) {\n          return 'success'\n        } else if (this.ws.isConnecting) {\n          return 'info'\n        } else {\n          return 'danger'\n        }\n      }\n    },\n    watch: {\n      ws_(val) {\n        this.ws = val\n      },\n      textArea(val) {\n        if (val !== '' && this.inputErr) {\n          this.inputErr = false\n        }\n      },\n      chatLog_: {\n        handler(val) {\n          this.getChatLog(val)\n        },\n        deep: true\n      },\n      activeTab(val) {\n        this.changeCurBox()\n      }\n    },\n    methods: {\n      wsConnect() {\n        if (this.ws.ready || this.ws.isConnecting) {\n          return\n        }\n        this.ws.connect(this)\n      },\n      scrollChange(e) {\n        let target = e.target\n        this.curBox.height = target.offsetHeight\n        this.curBox.scrollTop = target.scrollTop\n        this.curBox.scrollHeight = target.scrollHeight\n      },\n      contentScroll(flag) {\n        let chatBox = document.getElementsByClassName('chat-box-content')\n        if (chatBox.length > 0) {\n          for (const box of chatBox) {\n            if (box.offsetHeight > 0) {\n              box.scrollTop = flag ? 0 : (box.scrollHeight - box.offsetHeight)\n              this.curBox.height = box.offsetHeight\n              this.curBox.scrollTop = box.scrollTop\n              this.curBox.scrollHeight = box.scrollHeight\n              break\n            }\n          }\n        }\n      },\n      getChatLog(chatLog_) {\n        if (!chatLog_) {\n          this.chatLog = {}\n          return\n        }\n        const chat = {}\n        for (const key of Object.keys(chatLog_.group)) {\n          chat[`Group-${key}`] = chatLog_.group[key]\n        }\n        for (const key of Object.keys(chatLog_.private)) {\n          chat[`Private-${key}`] = chatLog_.private[key]\n        }\n        const keys = Object.keys(chat)\n        if (!keys.some(o => o === this.activeTab)) {\n          this.activeTab = keys[0]\n        }\n        this.chatLog = chat\n        this.moreLoading = false\n        this.changeCurBox()\n      },\n      changeCurBox() {\n        this.$nextTick(() => {\n          let chatBox = document.getElementsByClassName('chat-box-content')\n          if (chatBox.length > 0) {\n            for (const box of chatBox) {\n              if (box.offsetHeight > 0) {\n                this.curBox.height = box.offsetHeight\n                this.curBox.scrollTop = box.scrollTop\n                this.curBox.scrollHeight = box.scrollHeight\n                break\n              }\n            }\n          }\n        })\n      },\n      dateFormat(d) {\n        let date = new Date(d)\n        return `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`\n      },\n      msgFormat(message) {\n        let msg = String(message)\n        // msg = msg.replaceAll('\\n', '<br/>')\n        let atS = msg.indexOf('[CQ:at,qq=')\n        if (atS > -1) {\n          let atStr = msg.substring(atS + 10)\n          let atE = msg.indexOf(']')\n          let CQ = msg.substring(atS, atE + 1)\n          let at = atStr.substring(0, atStr.indexOf(']'))\n          msg = msg.replace(CQ, `<span class=\"color-at\">@${at}</span>`)\n        }\n        let curUrlPrefix = this.$cookies.get('curUrlPrefix')\n        let urlPrefix = curUrlPrefix ? this.$urlConf[curUrlPrefix + '_url'] : this.$urlConf['base_url']\n        return this.imgFormat(msg, urlPrefix)\n      },\n      imgFormat(msg, urlPrefix) {\n        if (msg.split('[CQ:image,').length > 1) {\n          let cqS = msg.indexOf('[CQ:image,')\n          let cqStr = msg.substring(cqS)\n          let cqE = cqStr.indexOf(']')\n          let CQ = cqStr.substring(0, cqE + 1)\n          if (CQ.indexOf('url') > -1) {\n            let urlS = CQ.indexOf('url=')\n            let urlStr = CQ.substring(urlS + 4)\n            let url = urlStr.substr(0, urlStr.indexOf('proxy=') > -1 ? urlStr.length - 9 : urlStr.length - 1)\n            // console.log(url)\n            let sp = url.split('.')\n            if ((sp.length > 1 && this.imgSuffix.some(o => sp[sp.length - 1].startsWith(o))) || url.indexOf('//gchat.qpic.cn/') > -1) {\n              url = urlPrefix + `xmbot/web/image.get?url=${url}`\n            }\n            msg = msg.replace(CQ, `<img class=\"display-block chat-item-img\" src=\"${url}\"/>`)\n          } else {\n            let fileS = CQ.indexOf('file=file:///')\n            let fileStr = CQ.substring(fileS + 13, CQ.length - 1)\n            let file = fileStr.substring(fileStr.indexOf('resource'))\n            console.log(fileStr, file)\n            let url = urlPrefix + 'xmbot/' + file.replaceAll('\\\\', '/')\n            msg = msg.replace(CQ, `<img class=\"display-block chat-item-img\" src=\"${url}\"/>`)\n          }\n          return this.imgFormat(msg, urlPrefix)\n        } else {\n          return msg\n        }\n      },\n      sendSubmit() {\n        if (this.textArea === '') {\n          this.inputErr = true\n          return\n        }\n        let receiver = this.activeTab.toLowerCase().split('-')\n        let reply = receiver[0] === 'group' ? 'group_id' : 'user_id'\n        const params = {message_type: receiver[0], message: this.textArea}\n        params[reply] = receiver[1]\n        this.$ajax({url: '/chat/sendMsg.do', method: 'post', data: params}).then(res => {\n          this.sendInit()\n        })\n      },\n      sendInit() {\n        this.textArea = ''\n      },\n      getMore() {\n        let split = this.activeTab.toLowerCase().split('-')\n        let params = {\n          type: split[0],\n          id: split[1],\n          index: this.chatLog[this.activeTab].rows[0].id\n        }\n        this.moreLoading = true\n        this.$ajax({url: '/chat/getMoreMsg.json', method: 'post', data: params})\n      }\n    },\n    created() {\n      if (this.$route.meta.auth) {\n        this.checkAuth()\n          .then(() => {\n            this.ws = this.$ws\n            this.getChatLog(this.$store.state.chatLog)\n            this.loading = false\n          })\n          .catch(err => {\n            this.$router.push('/index')\n            this.$destroy(this.$options.name)\n          })\n      } else\n        this.loading = false\n    }\n  }\n</script>\n\n<style scoped>\n  >>> .color-at {\n    color: #8cc5ff;\n  }\n\n  .chat-header {\n    box-shadow: inset 0 0 4px 1px #8c939d;\n    padding: 5px\n  }\n\n  .chat-box {\n    overflow: hidden;\n    box-shadow: inset 0 0 5px 1px #8c939d;\n    height: 830px;\n  }\n\n  .chat-box-tabs {\n    /*height: 800px;*/\n    /*overflow: auto;*/\n    position: relative;\n    box-shadow: inset 15px 0 8px -15px #8c939d;\n  }\n\n  .chat-box-content {\n    height: 560px;\n    overflow: auto;\n    padding: 15px 10px;\n    box-shadow: inset 0 -15px 8px -15px #8c939d;\n    position: relative;\n  }\n\n  .chat-box-more {\n    text-align: center;\n    font-size: 14px;\n    margin-bottom: 6px;\n  }\n\n  .chat-box-scroll {\n    position: absolute;\n    right: 30px;\n    font-size: 20px;\n    line-height: 36px;\n    height: 36px;\n    width: 36px;\n    text-align: center;\n    background-color: #fff;\n    cursor: pointer;\n    color: #409eff;\n    z-index: 999;\n    border-radius: 50%;\n    box-shadow: 0 0 6px rgba(0, 0, 0, .40);\n  }\n\n  .chat-box-scroll:hover {\n    background-color: #f2f6fc;\n  }\n\n  .scroll-to-top {\n    top: 5px;\n  }\n\n  .scroll-to-bottom {\n    top: 548px;\n  }\n\n  .chat-divider {\n    height: 10px;\n  }\n\n  .chat-box-input {\n    height: 210px;\n    box-shadow: inset 0 15px 8px -15px #8c939d;\n    padding: 10px;\n  }\n\n  .chat-box-input-btn {\n    padding: 8px 20px;\n    text-align: right;\n    position: relative;\n  }\n\n  .chat-input-err {\n    color: red;\n    position: absolute;\n    left: 0;\n    top: 0;\n    font-size: 14px;\n    line-height: 24px;\n  }\n\n  .chat-input-textarea >>> textarea {\n    line-height: 20px;\n    font-family: \"Microsoft YaHei\", serif;\n  }\n\n  .chat-box-row, .chat-box-row-self {\n    padding: 5px;\n    margin-bottom: 5px;\n    border-radius: 5px;\n  }\n\n  .chat-box-row:hover {\n    box-shadow: 0 0 3px 3px #8c939d;\n  }\n\n  .chat-box-row-self:hover {\n    box-shadow: 0 0 3px 3px #8cc5ff;\n  }\n\n  .chat-item {\n    padding: 5px 10px;\n    box-shadow: 0 0 2px 1px #8c939d;\n    border-radius: 5px;\n    display: inline-block;\n    float: left;\n  }\n\n  .chat-item-self {\n    padding: 5px 10px;\n    box-shadow: 0 0 2px 1px #409EFF;\n    border-radius: 5px;\n    display: inline-block;\n    float: right;\n  }\n\n  .chat-item-title {\n    padding: 0 5px 2px 5px;\n    font-size: 14px;\n    display: inline-block;\n  }\n\n  .chat-item .chat-item-title {\n    box-shadow: 0 6px 6px -6px #8c939d;\n  }\n\n  .chat-item-self .chat-item-title {\n    box-shadow: 0 6px 6px -6px #409EFF;\n  }\n\n  .chat-item-user {\n    font-size: 16px;\n  }\n\n  .chat-item-time {\n    font-size: 14px;\n    vertical-align: bottom;\n    color: #8c939d;\n  }\n\n  .chat-item-content {\n    max-width: 500px;\n    margin: 5px 0 0 0;\n    padding: 0 5px;\n    line-height: 24px;\n  }\n\n  >>> .chat-item-img {\n    max-width: 500px;\n  }\n\n  .border-err >>> textarea {\n    border-color: red !important;\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/others/socket-chat.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}]},[_c('el-row',{staticClass:\"text-center chat-header\"},[_c('el-link',{attrs:{\"type\":_vm.wsColor},on:{\"click\":_vm.wsConnect}},[_vm._v(_vm._s(_vm.wsStatus))])],1),_vm._v(\" \"),_c('div',{staticClass:\"chat-divider\"}),_vm._v(\" \"),(!_vm.loading)?_c('el-tabs',{staticClass:\"chat-box\",attrs:{\"tab-position\":\"left\"},model:{value:(_vm.activeTab),callback:function ($$v) {_vm.activeTab=$$v},expression:\"activeTab\"}},_vm._l((_vm.chatLog),function(val,key,index){return _c('el-tab-pane',{key:index,staticClass:\"chat-box-tabs\",attrs:{\"label\":key,\"name\":key}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.curBox.scrollTop>200),expression:\"curBox.scrollTop>200\"}],staticClass:\"chat-box-scroll scroll-to-top\",on:{\"click\":function($event){return _vm.contentScroll(true)}}},[_c('i',{staticClass:\"el-icon-caret-top\"})]),_vm._v(\" \"),_c('div',{ref:\"chatBox\",refInFor:true,staticClass:\"chat-box-content\",on:{\"scroll\":_vm.scrollChange}},[_c('el-row',{staticClass:\"chat-box-more\"},[_c('el-link',{attrs:{\"type\":\"info\",\"disabled\":val.noMore},on:{\"click\":_vm.getMore}},[_vm._v(\"\\n            \"+_vm._s(val.noMore?'没有更多':'加载更多')+\"\\n          \")])],1),_vm._v(\" \"),_vm._l((val.rows),function(item,k){return _c('el-row',{key:k,class:item['is_self']?'chat-box-row-self':'chat-box-row'},[_c('div',{class:item['is_self']?'chat-item-self':'chat-item'},[_c('div',{class:item['is_self']?'text-right chat-item-title':'chat-item-title'},[_c('el-tooltip',{attrs:{\"content\":item.user_id,\"placement\":\"top\"}},[_c('el-link',{staticClass:\"chat-item-user\"},[_vm._v(_vm._s(item['nick_name']))])],1),_vm._v(\" \"),_c('span',{staticClass:\"chat-item-time\"},[_vm._v(\" [\"+_vm._s(_vm.dateFormat(item['send_time']))+\"]\")])],1),_vm._v(\" \"),_c('p',{staticClass:\"chat-item-content\",domProps:{\"innerHTML\":_vm._s(_vm.msgFormat(item.message))}})])])})],2),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.curBox.scrollHeight-_vm.curBox.scrollTop > _vm.curBox.height+200),expression:\"curBox.scrollHeight-curBox.scrollTop > curBox.height+200\"}],staticClass:\"chat-box-scroll scroll-to-bottom\",on:{\"click\":function($event){return _vm.contentScroll(false)}}},[_c('i',{staticClass:\"el-icon-caret-bottom\"})]),_vm._v(\" \"),_c('div',{staticClass:\"chat-divider\"}),_vm._v(\" \"),_c('div',{staticClass:\"chat-box-input\"},[_c('el-input',{class:_vm.inputErr?'chat-input-textarea border-err':'chat-input-textarea',attrs:{\"type\":\"textarea\",\"rows\":8,\"placeholder\":\"请输入内容\",\"maxlength\":\"250\",\"show-word-limit\":\"\"},nativeOn:{\"keypress\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }$event.preventDefault();return _vm.sendSubmit($event)},\"keydown\":[function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }if(!$event.altKey){ return null; }_vm.textArea += '\\n'},function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }if(!$event.ctrlKey){ return null; }_vm.textArea += '\\n'}]},model:{value:(_vm.textArea),callback:function ($$v) {_vm.textArea=$$v},expression:\"textArea\"}}),_vm._v(\" \"),_c('div',{staticClass:\"chat-box-input-btn\"},[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.inputErr),expression:\"inputErr\"}],staticClass:\"chat-input-err\"},[_vm._v(\"未输入内容\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\",\"icon\":\"el-icon-delete\"},on:{\"click\":_vm.sendInit}},[_vm._v(\"清空\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"icon\":\"el-icon-check\"},on:{\"click\":_vm.sendSubmit}},[_vm._v(\"发送\")])],1)],1)])}),1):_vm._e()],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1457ac82\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/others/socket-chat.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1457ac82\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./socket-chat.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./socket-chat.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./socket-chat.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1457ac82\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./socket-chat.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-1457ac82\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/others/socket-chat.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}