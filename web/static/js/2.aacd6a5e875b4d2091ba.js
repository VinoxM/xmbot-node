webpackJsonp([2],{"5Twg":function(e,t,i){"use strict";i.d(t,"c",function(){return a}),i.d(t,"b",function(){return r}),i.d(t,"d",function(){return s}),i.d(t,"a",function(){return c});var n=i("gyMJ"),a=function(){return Object(n.d)({url:"/setting/live.json",method:"get"})},r=function(e){return Object(n.d)({url:"/bili/dynamic.json",method:"get",params:e})},s=function(e){return Object(n.d)({url:"/setting/live.save",method:"post",data:e})},c=function(e){return Object(n.d)({url:"/bili/dynamic.delete",method:"post",data:e})}},Bnf9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("fZjL"),a=i.n(n),r=i("pFYg"),s=i.n(r),c=i("BO1k"),l=i.n(c),o=i("5Twg"),d={name:"bili-dynamic",data:function(){return{}},props:["value","fullTime"],methods:{delDynamic:function(){this.value.deleting||(this.value.deleting=!0,this.$emit("delete"))},changeSelected:function(e){this.value.selected=!e,this.$emit("selected")}},created:function(){console.log(this.value)}},u={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",{staticStyle:{"margin-bottom":"8px"},attrs:{"body-style":"padding:10px 20px",shadow:"hover"},nativeOn:{click:function(t){return e.changeSelected(e.value.selected)}}},[i("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.value.retract,expression:"!value.retract"}],staticClass:"line-height-32"},[i("span",{staticClass:"text-time-top"},[e._v(e._s(e.fullTime?e.value.item.fullTime:e.value.item.time))]),e._v(" "),i("span",{class:e.fullTime?"text-ellipsis padding-long":"text-ellipsis padding-short"},[e._v(e._s(e.value.item.content))]),e._v(" "),i("span",{staticStyle:{position:"absolute",right:"0",top:"0"}},[i("el-checkbox",{staticStyle:{"margin-right":"6px"},attrs:{value:e.value.selected},on:{change:e.changeSelected}}),e._v(" "),i("i",{class:e.value.deleting?"el-icon-loading btn-deleting":"el-icon-delete btn-icon btn-danger",on:{click:function(t){return t.stopPropagation(),e.delDynamic(t)}}}),e._v(" "),i("i",{staticClass:"el-icon-arrow-down btn-icon",staticStyle:{"margin-left":"6px"},on:{click:function(t){t.stopPropagation(),e.value.retract=!0}}})],1)]),e._v(" "),i("el-row",{directives:[{name:"show",rawName:"v-show",value:e.value.retract,expression:"value.retract"}]},[i("el-row",{staticClass:"line-height-32"},[i("span",{staticClass:"text-time"},[e._v(e._s(e.fullTime?e.value.item.fullTime:e.value.item.time))]),e._v(" "),i("span",{staticStyle:{float:"right"}},[i("el-checkbox",{staticStyle:{"margin-right":"6px"},attrs:{value:e.value.selected},on:{change:e.changeSelected}}),e._v(" "),i("i",{class:e.value.deleting?"el-icon-loading btn-deleting":"el-icon-delete btn-icon btn-danger",on:{click:function(t){return t.stopPropagation(),e.delDynamic(t)}}}),e._v(" "),i("i",{staticClass:"el-icon-arrow-up btn-icon",staticStyle:{"margin-left":"6px"},on:{click:function(t){t.stopPropagation(),e.value.retract=!1}}})],1)]),e._v(" "),i("p",{staticClass:"text-ellipsis",staticStyle:{padding:"0 5px"},attrs:{title:e.value.item.content}},[e._v(e._s(e.value.item.content))]),e._v(" "),0!==e.value.item.orig_dy_id?i("el-card",{attrs:{"body-style":"padding:10px 20px;background-color:#f4f5f7",shadow:"never"}},[e.value.origin?i("el-row",{staticClass:"user-info-box-origin"},[i("div",{staticClass:"face-box"},[i("img",{attrs:{src:e.value.origin.user.head_url}})]),e._v(" "),i("span",{staticClass:"uname-span"},[e._v(e._s(e.value.origin.user.name))]),e._v(" "),i("span",{staticClass:"text-time"},[e._v(e._s(e.value.origin.item.upload_time))])]):e._e(),e._v(" "),i("p",{staticClass:"text-ellipsis",attrs:{title:e.value.origin?e.value.origin.item.description||e.value.origin.item.content:""}},[e._v("\n        "+e._s(e.value.item.tips||e.value.origin.item.description||e.value.origin.item.content))])],1):e._e()],1)],1)},staticRenderFns:[]};var m={name:"bili-dynamic",components:{"xm-dynamic":i("VU/8")(d,u,!1,function(e){i("M10P")},"data-v-7474ef3c",null).exports},data:function(){return{visible:!1,loading:!1,form:{uid:null,cookie:null,csrf:null,offsetId:0},dynamic:[],hasMore:!0,isSearching:!1,fullTime:!1,deleting:!1,checkAll:!1,isIndeterminate:!1}},computed:{userInfo:function(){return this.dynamic.length>0?this.dynamic[0].user:{face:null,uname:null,uid:null}},urlPrefix:function(){var e=this.$cookies.get("curUrlPrefix");return e?this.$urlConf[e+"_url"]:this.$urlConf.base_url}},methods:{getSettings:function(){var e=this;this.loading=!0,o.c().then(function(t){if(0!==t.code)return e.loading=!1,void e.$message.error(t.msg);e.form={uid:t.data.uid,cookie:"l=v; "+t.data.cookie,csrf:t.data.csrf_token,offsetId:0},e.loading=!1}).catch(function(t){e.loading=!1})},searchDynamic:function(e){var t=this;this.isSearching=!0,0===e&&(this.form.offsetId=0,this.dynamic=[]);var i={uid:this.form.uid||"",cookie:this.form.cookie||"",offsetId:this.form.offsetId};o.b(i).then(function(e){if(0===e.code&&0===e.data.code)if(t.form.offsetId===e.data.data.next_offset)t.hasMore=!1;else{t.form.offsetId=e.data.data.next_offset;var i=e.data.data.cards;if(i&&i.length>0){var n=!0,a=!1,r=void 0;try{for(var s,c=l()(i);!(n=(s=c.next()).done);n=!0){var o=s.value,d=t.handleJson(o.card);8===o.desc.type&&(d.item={timestamp:d.pubdate,content:"[Vidoe] "+d.title,orig_dy_id:0},d.user=d.owner),d.item.time=t.handleTime(d.item.timestamp),d.item.fullTime=t.handleTime(d.item.timestamp,!0),d.origin&&(8===d.item.orig_type&&(d.origin.item={upload_time:d.origin.pubdate,content:"[Video] "+d.origin.title},d.origin.user=d.origin.owner),d.origin.item.upload_time=t.handleTime(d.origin.item.upload_time||d.origin.item.timestamp),d.origin.user.head_url=t.urlPrefix+"xmbot/web/image.get?url="+(d.origin.user.head_url||d.origin.user.face)),d.retract=!1,d.selected=!1,d.desc=o.desc,d.deleting=!1,t.dynamic.push(d)}}catch(e){a=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw r}}}}t.changeIndeterminate(),t.isSearching=!1}).catch(function(e){t.isSearching=!1})},getFaceSrc:function(){return this.userInfo.face?this.urlPrefix+"xmbot/web/image.get?url="+this.userInfo.face:""},handleJson:function(e){var t=this;if("object"===(void 0===e?"undefined":s()(e))){if(e instanceof Array)e.map(function(e){return t.handleJson(e)});else if(e instanceof Object){var i=!0,n=!1,r=void 0;try{for(var c,o=l()(a()(e));!(i=(c=o.next()).done);i=!0){var d=c.value;e[d]=this.handleJson(e[d])}}catch(e){n=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw r}}}return e}if(""===e)return e;var u="";try{u=JSON.parse(e)}catch(t){return e}return"object"===(void 0===u?"undefined":s()(u))?this.handleJson(u):e},handleTime:function(e,t){var i=new Date;return i.setTime(1e3*e),t?i.getFullYear()+"-"+String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0")+" "+String(i.getHours()).padStart(2,"0")+":"+String(i.getMinutes()).padStart(2,"0")+":"+String(i.getSeconds()).padStart(2,"0"):String(i.getMonth()+1).padStart(2,"0")+"-"+String(i.getDate()).padStart(2,"0")+" "},delOneDynamic:function(e,t){var i=this,n={dynamic_id:e.desc.dynamic_id_str,csrf:this.form.csrf,cookie:this.form.cookie};o.a(n).then(function(e){0===e.data.code?(i.dynamic.splice(t,1),i.$message.success(e.msg)):(i.dynamic[t].deleting=!1,i.$message.error(e.data.message))}).catch(function(e){i.dynamic[t].deleting=!1})},changeCheckAll:function(e){this.dynamic.map(function(t){return t.selected=e,t}),this.isIndeterminate=!1},changeIndeterminate:function(){if(this.checkAll=!this.dynamic.some(function(e){return!e.selected}),1===this.dynamic.length)this.isIndeterminate=!1;else{for(var e=!1,t=!0,i=0;i<this.dynamic.length;i++)0!==i?e=t!==this.dynamic[i].selected:t=this.dynamic[i].selected;this.isIndeterminate=e}},retractAll:function(e){this.dynamic.map(function(t){return t.retract=e,t})},deleteAll:function(){var e=this;this.dynamic.map(function(t){if(!t.selected)return t;t.deleting=!0;var i=t.desc.dynamic_id_str,n={dynamic_id:i,csrf:e.form.csrf,cookie:e.form.cookie};o.a(n).then(function(t){var n=e.dynamic.findIndex(function(e){return e.desc.dynamic_id_str===i});0===t.data.code?e.dynamic.splice(n,1):e.dynamic[n].deleting=!1}).catch(function(t){var n=e.dynamic.findIndex(function(e){return e.desc.dynamic_id_str===i});e.dynamic[n].deleting=!1})}),this.checkAll=!1,this.isIndeterminate=!1}},created:function(){var e=this;this.$route.meta.auth?this.checkAuth().then(function(){e.getSettings()}).catch(function(t){e.$router.push("/index"),e.$destroy(e.$options.name)}):this.getSettings()}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-row",[i("el-drawer",{attrs:{direction:"ttb",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[i("el-form",{staticClass:"form-box",attrs:{"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"用户ID"}},[i("el-input",{model:{value:e.form.uid,callback:function(t){e.$set(e.form,"uid",t)},expression:"form.uid"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"Csrf"}},[i("el-input",{model:{value:e.form.csrf,callback:function(t){e.$set(e.form,"csrf",t)},expression:"form['csrf']"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"Cookie"}},[i("el-input",{attrs:{type:"textarea",rows:"4",resize:"none"},model:{value:e.form.cookie,callback:function(t){e.$set(e.form,"cookie",t)},expression:"form.cookie"}})],1)],1)],1),e._v(" "),i("el-row",{staticClass:"search-tool-bar"},[i("div",{staticStyle:{position:"absolute",left:"10px",top:"0"}},[i("el-button",{attrs:{icon:"el-icon-setting",size:"small"},on:{click:function(t){e.visible=!0}}}),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.isSearching,icon:"el-icon-search"},on:{click:function(t){return e.searchDynamic(0)}}},[e._v("Search\n      ")]),e._v(" "),i("el-switch",{attrs:{"active-text":"显示完整时间","inactive-text":"只显示日期"},model:{value:e.fullTime,callback:function(t){e.fullTime=t},expression:"fullTime"}})],1),e._v(" "),e.userInfo.uid||e.userInfo.mid?i("div",{staticClass:"user-info-box"},[i("div",{staticClass:"face-box"},[i("img",{attrs:{src:e.getFaceSrc()}})]),e._v(" "),i("span",{staticClass:"uname-span"},[e._v(e._s(e.userInfo.uname||e.userInfo.name))])]):e._e(),e._v(" "),e.userInfo.uid||e.userInfo.mid?i("span",{staticClass:"search-tool-btn"},[i("el-checkbox",{staticStyle:{"margin-right":"6px"},attrs:{indeterminate:e.isIndeterminate},on:{change:e.changeCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}}),e._v(" "),i("i",{class:e.deleting?"el-icon-loading btn-deleting":"el-icon-delete btn-danger",on:{click:e.deleteAll}}),e._v(" "),i("span",{staticClass:"search-expand-btn"},[i("i",{staticClass:"el-icon-arrow-up",on:{click:function(t){return e.retractAll(!1)}}}),e._v(" "),i("i",{staticClass:"el-icon-arrow-down",on:{click:function(t){return e.retractAll(!0)}}})])],1):e._e()]),e._v(" "),i("el-row",{staticStyle:{position:"relative"}},[i("el-row",{staticClass:"dynamic-box"},[e._l(e.dynamic,function(t,n){return i("xm-dynamic",{key:n,attrs:{value:t,"full-time":e.fullTime},on:{"update:value":function(e){t=e},selected:e.changeIndeterminate,delete:function(i){return e.delOneDynamic(t,n)}}})}),e._v(" "),0!==e.form.offsetId?i("el-row",{staticStyle:{"text-align":"center"}},[e.hasMore?i("el-link",{attrs:{disabled:e.isSearching},on:{click:e.searchDynamic}},[e._v("加载更多")]):i("el-link",{attrs:{disabled:""}},[e._v("没有更多")])],1):e._e()],2),e._v(" "),i("el-backtop",{staticStyle:{position:"absolute",right:"10px",bottom:"10px"},attrs:{target:".dynamic-box"}})],1)],1)},staticRenderFns:[]};var h=i("VU/8")(m,f,!1,function(e){i("PhUo")},"data-v-2176bf72",null);t.default=h.exports},M10P:function(e,t){},PhUo:function(e,t){}});
//# sourceMappingURL=2.aacd6a5e875b4d2091ba.js.map