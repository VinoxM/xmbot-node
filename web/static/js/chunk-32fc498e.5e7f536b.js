(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32fc498e"],{"0cb2":function(t,e,n){var r=n("7b0b"),i=Math.floor,a="".replace,o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,s=/\$([$&'`]|\d{1,2})/g;t.exports=function(t,e,n,c,l,u){var h=n+t.length,f=c.length,d=s;return void 0!==l&&(l=r(l),d=o),a.call(u,d,(function(r,a){var o;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,n);case"'":return e.slice(h);case"<":o=l[a.slice(1,-1)];break;default:var s=+a;if(0===s)return r;if(s>f){var u=i(s/10);return 0===u?r:u<=f?void 0===c[u-1]?a.charAt(1):c[u-1]+a.charAt(1):r}o=c[s-1]}return void 0===o?"":o}))}},"0ccb":function(t,e,n){var r=n("50c4"),i=n("1148"),a=n("1d80"),o=Math.ceil,s=function(t){return function(e,n,s){var c,l,u=String(a(e)),h=u.length,f=void 0===s?" ":String(s),d=r(n);return d<=h||""==f?u:(c=d-h,l=i.call(f,o(c/f.length)),l.length>c&&(l=l.slice(0,c)),t?u+l:l+u)}};t.exports={start:s(!1),end:s(!0)}},1148:function(t,e,n){"use strict";var r=n("a691"),i=n("1d80");t.exports="".repeat||function(t){var e=String(i(this)),n="",a=r(t);if(a<0||a==1/0)throw RangeError("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(n+=e);return n}},"2ca0":function(t,e,n){"use strict";var r=n("23e7"),i=n("06cf").f,a=n("50c4"),o=n("5a34"),s=n("1d80"),c=n("ab13"),l=n("c430"),u="".startsWith,h=Math.min,f=c("startsWith"),d=!l&&!f&&!!function(){var t=i(String.prototype,"startsWith");return t&&!t.writable}();r({target:"String",proto:!0,forced:!d&&!f},{startsWith:function(t){var e=String(s(this));o(t);var n=a(h(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return u?u.call(e,r,n):e.slice(n,n+r.length)===r}})},"4d90":function(t,e,n){"use strict";var r=n("23e7"),i=n("0ccb").start,a=n("9a0c");r({target:"String",proto:!0,forced:a},{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},5319:function(t,e,n){"use strict";var r=n("d784"),i=n("825a"),a=n("50c4"),o=n("a691"),s=n("1d80"),c=n("8aa5"),l=n("0cb2"),u=n("14c3"),h=Math.max,f=Math.min,d=function(t){return void 0===t?t:String(t)};r("replace",2,(function(t,e,n,r){var g=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,p=r.REPLACE_KEEPS_$0,v=g?"$":"$0";return[function(n,r){var i=s(this),a=void 0==n?void 0:n[t];return void 0!==a?a.call(n,i,r):e.call(String(i),n,r)},function(t,r){if(!g&&p||"string"===typeof r&&-1===r.indexOf(v)){var s=n(e,t,this,r);if(s.done)return s.value}var b=i(t),m=String(this),x="function"===typeof r;x||(r=String(r));var w=b.global;if(w){var y=b.unicode;b.lastIndex=0}var _=[];while(1){var C=u(b,m);if(null===C)break;if(_.push(C),!w)break;var S=String(C[0]);""===S&&(b.lastIndex=c(m,a(b.lastIndex),y))}for(var k="",T=0,B=0;B<_.length;B++){C=_[B];for(var E=String(C[0]),A=h(f(o(C.index),m.length),0),$=[],H=1;H<C.length;H++)$.push(d(C[H]));var O=C.groups;if(x){var L=[E].concat($,A,m);void 0!==O&&L.push(O);var I=String(r.apply(void 0,L))}else I=l(E,m,A,$,O,r);A>=T&&(k+=m.slice(T,A)+I,T=A+E.length)}return k+m.slice(T)}]}))},"5a34":function(t,e,n){var r=n("44e7");t.exports=function(t){if(r(t))throw TypeError("The method doesn't accept regular expressions");return t}},"9a0c":function(t,e,n){var r=n("342f");t.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r)},a185:function(t,e,n){"use strict";n("efbb")},ab13:function(t,e,n){var r=n("b622"),i=r("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[i]=!1,"/./"[t](e)}catch(r){}}return!1}},b85c:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");var r=n("06c5");function i(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Object(r["a"])(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==n["return"]||n["return"]()}finally{if(c)throw o}}}}},e6a7:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[n("el-row",{staticClass:"text-center chat-header"},[n("el-link",{attrs:{type:t.wsColor},on:{click:t.wsConnect}},[t._v(t._s(t.wsStatus))]),n("el-dropdown",{staticStyle:{position:"absolute",right:"10px",top:"5px"}},[n("span",{class:t.apiStatus.ready?"cur-pointer":"cur-not-allowed"},[t._v("Api状态("+t._s(t.apiStatus.bot.length)+")"),t.apiStatus.ready?n("i",{staticClass:"el-icon-arrow-down el-icon--right"}):t._e()]),t.apiStatus.ready?n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.apiStatus.api,(function(e,r,i){return n("el-dropdown-item",[n("span",[t._v(t._s(r)+": ")]),n("el-tag",{attrs:{type:e?"success":"info",size:"small"}},[t._v(t._s(e?"已启动":"未启动"))])],1)})),1):t._e()],1)],1),n("div",{staticClass:"chat-divider"}),t.loading?t._e():n("el-tabs",{staticClass:"chat-box",attrs:{"tab-position":"left"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.chatLog,(function(e,r,i){return n("el-tab-pane",{key:i,staticClass:"chat-box-tabs",attrs:{name:r}},[n("div",{attrs:{slot:"label"},slot:"label"},[0===e.newCount?n("span",[t._v(t._s(r))]):n("el-badge",{staticStyle:{"vertical-align":"top"},attrs:{value:e.newCount,max:99}},[n("span",[t._v(t._s(r))])])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.curBox.scrollTop>200,expression:"curBox.scrollTop>200"}],staticClass:"chat-box-scroll scroll-to-top",on:{click:function(e){return t.contentScroll(!0)}}},[n("i",{staticClass:"el-icon-caret-top"})]),n("div",{ref:"chatBox",refInFor:!0,class:t.hideInput?"chat-box-content content-tall":"chat-box-content",on:{scroll:t.scrollChange}},[n("el-row",{staticClass:"chat-box-more"},[n("el-link",{attrs:{type:"info",disabled:e.noMore},on:{click:t.getMore}},[t._v(" "+t._s(e.noMore?"没有更多":"加载更多")+" ")])],1),t._l(e.rows,(function(e,r){return n("el-row",{key:r,class:e["is_self"]?"chat-box-row-self":"chat-box-row"},[n("div",{class:e["is_self"]?"chat-item-self":"chat-item"},[n("div",{class:e["is_self"]?"text-right chat-item-title":"chat-item-title"},[n("el-tooltip",{attrs:{content:e.user_id,placement:"top"}},[n("el-link",{staticClass:"chat-item-user"},[t._v(t._s(e["nick_name"]))])],1),n("span",{staticClass:"chat-item-time"},[t._v(" ["+t._s(t.dateFormat(e["send_time"]))+"]")])],1),n("p",{staticClass:"chat-item-content",domProps:{innerHTML:t._s(t.msgFormat(e.message))}})])])}))],2),n("div",{directives:[{name:"show",rawName:"v-show",value:t.curBox.scrollHeight-t.curBox.scrollTop>t.curBox.height+200,expression:"curBox.scrollHeight-curBox.scrollTop > curBox.height+200"}],class:t.hideInput?"chat-box-scroll scroll-to-bottom-tall":"chat-box-scroll scroll-to-bottom",on:{click:function(e){return t.contentScroll(!1)}}},[n("i",{staticClass:"el-icon-caret-bottom"})]),n("div",{class:t.hideInput?"chat-divider-tall":"chat-divider"},[t.hideInput?n("span",{staticClass:"input-open-btn",on:{click:function(e){return t.hideInputToggle(!1)}}},[n("i",{staticClass:"el-icon-d-arrow-left"})]):t._e()]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.hideInput,expression:"!hideInput"}],staticClass:"chat-box-input"},[n("el-input",{class:t.inputErr?"chat-input-textarea border-err":"chat-input-textarea",attrs:{readonly:!t.isAdmin,type:"textarea",rows:6,placeholder:t.isAdmin?"请输入内容":"权限不足",maxlength:"250","show-word-limit":""},nativeOn:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.sendSubmit(e))},keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.altKey?void(t.textArea+="\n"):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?void(t.textArea+="\n"):null}]},model:{value:t.textArea,callback:function(e){t.textArea=e},expression:"textArea"}}),n("div",{staticClass:"chat-box-input-btn"},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.inputErr,expression:"inputErr"}],staticClass:"chat-input-err"},[t._v("未输入内容")]),n("el-button",{staticClass:"icon-translate-90",attrs:{size:"small",icon:"el-icon-d-arrow-right"},on:{click:function(e){return t.hideInputToggle(!0)}}},[t._v("收起 ")]),n("el-button",{attrs:{size:"small",icon:"el-icon-delete",disabled:!t.isAdmin},on:{click:t.sendInit}},[t._v("清空")]),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-check",disabled:!t.isAdmin},on:{click:t.sendSubmit}},[t._v("发送 ")])],1)],1)])})),1)],1)},i=[],a=n("b85c"),o=(n("b64b"),n("99af"),n("4d90"),n("5319"),n("ac1f"),n("1276"),n("2ca0"),n("b0c0"),n("a417")),s={name:"home",data:function(){return{loading:!0,imgSuffix:["jpg","jpeg","png","gif"],ws:{},textArea:"",altEnter:!1,inputErr:!1,activeTab:"",chatLog:{},curBox:{height:0,scrollTop:0,scrollHeight:0},hideInput:!1}},computed:{isAdmin:function(){return this.$store.state.isAdmin},ws_:function(){return this.$ws},chatLog_:function(){return this.$store.state.chatLog},wsStatus:function(){return this.ws.ready?"已连接到服务器":this.ws.isConnecting?"连接服务器中":"未连接到服务器"},wsColor:function(){return this.ws.ready?"success":this.ws.isConnecting?"info":"danger"},apiStatus:function(){return this.$store.state.botReady}},watch:{ws_:function(t){this.ws=t},textArea:function(t){""!==t&&this.inputErr&&(this.inputErr=!1)},chatLog_:{handler:function(t){this.getChatLog(t)},deep:!0},activeTab:function(t){this.changeCurBox(),this.chatLog[t]&&this.chatLog[t].hasOwnProperty("hasNew")&&this.chatLog[t].hasNew&&this.scrollToBottom()}},methods:{wsConnect:function(){this.ws.ready||this.ws.isConnecting||this.ws.connect(this)},scrollChange:function(t){var e=t.target;this.curBox.height=e.offsetHeight,this.curBox.scrollTop=e.scrollTop,this.curBox.scrollHeight=e.scrollHeight},contentScroll:function(t){var e=document.getElementsByClassName("chat-box-content");if(e.length>0){var n,r=Object(a["a"])(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.offsetHeight>0){i.scrollTop=t?0:i.scrollHeight-i.offsetHeight,this.curBox.height=i.offsetHeight,this.curBox.scrollTop=i.scrollTop,this.curBox.scrollHeight=i.scrollHeight;break}}}catch(o){r.e(o)}finally{r.f()}}},hideInputToggle:function(t){var e=!1;if(!t){var n=document.getElementsByClassName("chat-box-content");if(n.length>0){var r,i=Object(a["a"])(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.offsetHeight>0){e=o.scrollHeight-o.offsetHeight<=o.scrollTop;break}}}catch(s){i.e(s)}finally{i.f()}}}this.hideInput=t,e&&this.scrollToBottom()},getChatLog:function(t){var e=this;if(t){for(var n={},r=0,i=Object.keys(t.group);r<i.length;r++){var a=i[r];n["Group-".concat(a)]=t.group[a]}for(var o=0,s=Object.keys(t.private);o<s.length;o++){var c=s[o];n["Private-".concat(c)]=t.private[c]}var l=Object.keys(n);l.some((function(t){return t===e.activeTab}))||(this.activeTab=l[0]),this.chatLog=n,this.changeCurBox(),this.chatLog[this.activeTab]&&this.chatLog[this.activeTab].hasNew&&this.scrollToBottom()}else this.chatLog={}},changeCurBox:function(){var t=this;this.$nextTick((function(){var e=document.getElementsByClassName("chat-box-content");if(e.length>0){var n,r=Object(a["a"])(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.offsetHeight>0){t.curBox.height=i.offsetHeight,t.curBox.scrollTop=i.scrollTop,t.curBox.scrollHeight=i.scrollHeight;break}}}catch(o){r.e(o)}finally{r.f()}}}))},scrollToBottom:function(){var t=this;this.$nextTick((function(){var e=document.getElementsByClassName("chat-box-content");if(e.length>0){var n,r=Object(a["a"])(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.offsetHeight>0){i.scrollTop=i.scrollHeight,t.curBox.height=i.offsetHeight,t.curBox.scrollTop=i.scrollTop,t.curBox.scrollHeight=i.scrollHeight,t.chatLog[t.activeTab].hasNew=!1,t.chatLog[t.activeTab].newCount=0;break}}}catch(o){r.e(o)}finally{r.f()}}}))},dateFormat:function(t){var e=new Date(t);return"".concat(e.getFullYear(),"/").concat(e.getMonth()+1,"/").concat(e.getDate()," ").concat(String(e.getHours()).padStart(2,"0"),":").concat(String(e.getMinutes()).padStart(2,"0"),":").concat(String(e.getSeconds()).padStart(2,"0"))},msgFormat:function(t){var e=String(t);e=e.replaceAll("\n","<br/>");var n=e.indexOf("[CQ:at,qq=");if(n>-1){var r=e.substring(n+10),i=e.indexOf("]"),a=e.substring(n,i+1),o=r.substring(0,r.indexOf("]"));e=e.replace(a,'<span class="color-at">@'.concat(o,"</span>"))}var s=this.$cookies.get("curUrlPrefix"),c=s?this.$urlConf[s+"_url"]:this.$urlConf["base_url"];return this.imgFormat(e,c)},imgFormat:function(t,e){if(t.split("[CQ:image,").length>1){var n=t.indexOf("[CQ:image,"),r=t.substring(n),i=r.indexOf("]"),a=r.substring(0,i+1);if(a.indexOf("url")>-1){var o=a.indexOf("url="),s=a.substring(o+4),c=s.substr(0,s.indexOf("proxy=")>-1?s.length-9:s.length-1),l=c.split(".");(l.length>1&&this.imgSuffix.some((function(t){return l[l.length-1].startsWith(t)}))||c.indexOf("//gchat.qpic.cn/")>-1)&&(c=e+"xmbot/web/image.get?url=".concat(c)),t=t.replace(a,'<img class="display-block chat-item-img" src="'.concat(c,'"/>'))}else{var u=a.indexOf("file=file:///"),h=a.substring(u+13,a.length-1),f=h.substring(h.indexOf("resource")),d=e+"xmbot/"+f.replaceAll("\\","/");t=t.replace(a,'<img class="display-block chat-item-img" src="'.concat(d,'"/>'))}return this.imgFormat(t,e)}return t},sendSubmit:function(){var t=this;if(""!==this.textArea){var e=this.activeTab.toLowerCase().split("-"),n="group"===e[0]?"group_id":"user_id",r={message_type:e[0],message:this.textArea};r[n]=e[1].split("_")[0],r.apiName=e[1].split("_")[1],this.$ajax({url:"/chat/sendMsg.do",method:"post",data:r}).then((function(e){t.sendInit()}))}else this.inputErr=!0},sendInit:function(){this.textArea=""},getMore:function(){var t=this.activeTab.toLowerCase().split("-"),e={type:t[0],id:t[1],apiName:t[2],index:this.chatLog[this.activeTab].rows[0].id};this.moreLoading=!0,this.$ajax({url:"/chat/getMoreMsg.json",method:"post",data:e})}},created:function(){var t=this;this.$route.meta.auth?this.checkAuth().then((function(){t.ws=t.$ws,t.getChatLog(t.$store.state.chatLog),t.loading=!1,t.hideInput=!t.isAdmin,o["c"]()})).catch((function(e){t.$router.push("/index"),t.$destroy(t.$options.name)})):this.loading=!1}},c=s,l=(n("a185"),n("2877")),u=Object(l["a"])(c,r,i,!1,null,"70078276",null);e["default"]=u.exports},efbb:function(t,e,n){}}]);
//# sourceMappingURL=chunk-32fc498e.5e7f536b.js.map