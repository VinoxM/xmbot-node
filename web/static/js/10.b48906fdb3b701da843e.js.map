{"version":3,"sources":["webpack:///src/components/others/socket-chat.vue","webpack:///./src/components/others/socket-chat.vue?b30c","webpack:///./src/components/others/socket-chat.vue"],"names":["socket_chat","name","data","loading","imgSuffix","ws","textArea","altEnter","inputErr","activeTab","chatLog","curBox","height","scrollTop","scrollHeight","computed","ws_","this","$ws","chatLog_","$store","state","wsStatus","ready","isConnecting","wsColor","watch","val","handler","getChatLog","deep","changeCurBox","console","log","hasOwnProperty","hasNew","scrollToBottom","methods","wsConnect","connect","scrollChange","e","target","offsetHeight","contentScroll","flag","chatBox","document","getElementsByClassName","length","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","box","value","err","return","_this","chat","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","keys_default","group","key","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","private","_key","keys","some","o","_this2","$nextTick","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_this3","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","newCount","dateFormat","d","date","Date","getFullYear","getMonth","getDate","String","getHours","padStart","getMinutes","getSeconds","msgFormat","message","msg","atS","indexOf","atStr","substring","atE","CQ","at","replace","curUrlPrefix","$cookies","get","urlPrefix","$urlConf","imgFormat","split","cqS","cqStr","cqE","urlS","urlStr","url","substr","sp","startsWith","fileS","fileStr","file","_url","replaceAll","sendSubmit","_this4","receiver","toLowerCase","reply","params","message_type","$ajax","method","then","res","sendInit","getMore","type","id","index","rows","moreLoading","created","_this5","$route","meta","auth","checkAuth","catch","$router","push","$destroy","$options","others_socket_chat","render","_vm","_h","$createElement","_c","_self","directives","rawName","expression","staticClass","attrs","on","click","_v","_s","_e","tab-position","model","callback","$$v","_l","slot","staticStyle","vertical-align","max","$event","ref","refInFor","scroll","disabled","noMore","item","k","class","content","user_id","placement","domProps","innerHTML","placeholder","maxlength","show-word-limit","nativeOn","keypress","_k","keyCode","preventDefault","keydown","altKey","ctrlKey","size","icon","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/10.b48906fdb3b701da843e.js","sourcesContent":["<template>\n  <div v-loading=\"loading\">\n    <el-row class=\"text-center chat-header\">\n      <el-link :type=\"wsColor\" @click=\"wsConnect\">{{wsStatus}}</el-link>\n    </el-row>\n    <div class=\"chat-divider\"></div>\n    <el-tabs tab-position=\"left\" v-if=\"!loading\" class=\"chat-box\" v-model=\"activeTab\">\n      <el-tab-pane v-for=\"(val,key,index) of chatLog\" :key=\"index\" class=\"chat-box-tabs\" :name=\"key\">\n        <div slot=\"label\">\n          <span v-if=\"val.newCount===0\">{{key}}</span>\n          <el-badge v-else :value=\"val.newCount\" :max=\"99\" style=\"vertical-align: top\">\n            <span>{{key}}</span>\n          </el-badge>\n        </div>\n        <div class=\"chat-box-scroll scroll-to-top\" v-show=\"curBox.scrollTop>200\" @click=\"contentScroll(true)\">\n          <i class=\"el-icon-caret-top\"></i>\n        </div>\n        <div class=\"chat-box-content\" ref=\"chatBox\" @scroll=\"scrollChange\">\n          <el-row class=\"chat-box-more\">\n            <el-link type=\"info\" @click=\"getMore\" :disabled=\"val.noMore\">\n              {{val.noMore?'没有更多':'加载更多'}}\n            </el-link>\n          </el-row>\n          <el-row v-for=\"(item,k) of val.rows\" :key=\"k\" :class=\"item['is_self']?'chat-box-row-self':'chat-box-row'\">\n            <div :class=\"item['is_self']?'chat-item-self':'chat-item'\">\n              <div :class=\"item['is_self']?'text-right chat-item-title':'chat-item-title'\">\n                <el-tooltip :content=\"item.user_id\" placement=\"top\">\n                  <el-link class=\"chat-item-user\">{{item['nick_name']}}</el-link>\n                </el-tooltip>\n                <span class=\"chat-item-time\"> [{{dateFormat(item['send_time'])}}]</span>\n              </div>\n              <p v-html=\"msgFormat(item.message)\" class=\"chat-item-content\"></p>\n            </div>\n          </el-row>\n        </div>\n        <div class=\"chat-box-scroll scroll-to-bottom\" v-show=\"curBox.scrollHeight-curBox.scrollTop > curBox.height+200\"\n             @click=\"contentScroll(false)\">\n          <i class=\"el-icon-caret-bottom\"></i>\n        </div>\n        <div class=\"chat-divider\"></div>\n        <div class=\"chat-box-input\">\n          <el-input type=\"textarea\" :rows=\"6\" placeholder=\"请输入内容\" v-model=\"textArea\" maxlength=\"250\" show-word-limit\n                    :class=\"inputErr?'chat-input-textarea border-err':'chat-input-textarea'\"\n                    @keypress.enter.native.prevent=\"sendSubmit\"\n                    @keydown.alt.enter.native=\"textArea += '\\n'\"\n                    @keydown.ctrl.enter.native=\"textArea += '\\n'\"\n          ></el-input>\n          <div class=\"chat-box-input-btn\">\n            <span class=\"chat-input-err\" v-show=\"inputErr\">未输入内容</span>\n            <el-button size=\"small\" icon=\"el-icon-delete\" @click=\"sendInit\">清空</el-button>\n            <el-button size=\"small\" type=\"primary\" icon=\"el-icon-check\" @click=\"sendSubmit\">发送</el-button>\n          </div>\n        </div>\n      </el-tab-pane>\n    </el-tabs>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: \"home\",\n    data() {\n      return {\n        loading: true,\n        imgSuffix: ['jpg', 'jpeg', 'png', 'gif'],\n        ws: {},\n        textArea: '',\n        altEnter: false,\n        inputErr: false,\n        activeTab: '',\n        chatLog: {},\n        curBox: {\n          height: 0,\n          scrollTop: 0,\n          scrollHeight: 0\n        }\n      }\n    },\n    computed: {\n      ws_() {\n        return this.$ws\n      },\n      chatLog_() {\n        return this.$store.state.chatLog\n      },\n      wsStatus() {\n        if (this.ws.ready) {\n          return '已连接到服务器'\n        } else if (this.ws.isConnecting) {\n          return '连接服务器中'\n        } else {\n          return '未连接到服务器'\n        }\n      },\n      wsColor() {\n        if (this.ws.ready) {\n          return 'success'\n        } else if (this.ws.isConnecting) {\n          return 'info'\n        } else {\n          return 'danger'\n        }\n      }\n    },\n    watch: {\n      ws_(val) {\n        this.ws = val\n      },\n      textArea(val) {\n        if (val !== '' && this.inputErr) {\n          this.inputErr = false\n        }\n      },\n      chatLog_: {\n        handler(val) {\n          this.getChatLog(val)\n        },\n        deep: true\n      },\n      activeTab(val) {\n        this.changeCurBox()\n        console.log(this.chatLog[val])\n        if (this.chatLog[val] && this.chatLog[val].hasOwnProperty('hasNew') && this.chatLog[val].hasNew) this.scrollToBottom()\n      }\n    },\n    methods: {\n      wsConnect() {\n        if (this.ws.ready || this.ws.isConnecting) {\n          return\n        }\n        this.ws.connect(this)\n      },\n      scrollChange(e) {\n        let target = e.target\n        this.curBox.height = target.offsetHeight\n        this.curBox.scrollTop = target.scrollTop\n        this.curBox.scrollHeight = target.scrollHeight\n      },\n      contentScroll(flag) {\n        let chatBox = document.getElementsByClassName('chat-box-content')\n        if (chatBox.length > 0) {\n          for (const box of chatBox) {\n            if (box.offsetHeight > 0) {\n              box.scrollTop = flag ? 0 : (box.scrollHeight - box.offsetHeight)\n              this.curBox.height = box.offsetHeight\n              this.curBox.scrollTop = box.scrollTop\n              this.curBox.scrollHeight = box.scrollHeight\n              break\n            }\n          }\n        }\n      },\n      getChatLog(chatLog_) {\n        if (!chatLog_) {\n          this.chatLog = {}\n          return\n        }\n        const chat = {}\n        for (const key of Object.keys(chatLog_.group)) {\n          chat[`Group-${key}`] = chatLog_.group[key]\n        }\n        for (const key of Object.keys(chatLog_.private)) {\n          chat[`Private-${key}`] = chatLog_.private[key]\n        }\n        const keys = Object.keys(chat)\n        if (!keys.some(o => o === this.activeTab)) {\n          this.activeTab = keys[0]\n        }\n        this.chatLog = chat\n        this.changeCurBox()\n        if (this.chatLog[this.activeTab].hasNew) this.scrollToBottom()\n      },\n      changeCurBox() {\n        this.$nextTick(() => {\n          let chatBox = document.getElementsByClassName('chat-box-content')\n          if (chatBox.length > 0) {\n            for (const box of chatBox) {\n              if (box.offsetHeight > 0) {\n                this.curBox.height = box.offsetHeight\n                this.curBox.scrollTop = box.scrollTop\n                this.curBox.scrollHeight = box.scrollHeight\n                break\n              }\n            }\n          }\n        })\n      },\n      scrollToBottom() {\n        this.$nextTick(() => {\n          let chatBox = document.getElementsByClassName('chat-box-content')\n          if (chatBox.length > 0) {\n            for (const box of chatBox) {\n              if (box.offsetHeight > 0) {\n                box.scrollTop = box.scrollHeight\n                this.curBox.height = box.offsetHeight\n                this.curBox.scrollTop = box.scrollTop\n                this.curBox.scrollHeight = box.scrollHeight\n                this.chatLog[this.activeTab].hasNew = false\n                this.chatLog[this.activeTab].newCount = 0\n                break\n              }\n            }\n          }\n        })\n      },\n      dateFormat(d) {\n        let date = new Date(d)\n        return `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`\n      },\n      msgFormat(message) {\n        let msg = String(message)\n        // msg = msg.replaceAll('\\n', '<br/>')\n        let atS = msg.indexOf('[CQ:at,qq=')\n        if (atS > -1) {\n          let atStr = msg.substring(atS + 10)\n          let atE = msg.indexOf(']')\n          let CQ = msg.substring(atS, atE + 1)\n          let at = atStr.substring(0, atStr.indexOf(']'))\n          msg = msg.replace(CQ, `<span class=\"color-at\">@${at}</span>`)\n        }\n        let curUrlPrefix = this.$cookies.get('curUrlPrefix')\n        let urlPrefix = curUrlPrefix ? this.$urlConf[curUrlPrefix + '_url'] : this.$urlConf['base_url']\n        return this.imgFormat(msg, urlPrefix)\n      },\n      imgFormat(msg, urlPrefix) {\n        if (msg.split('[CQ:image,').length > 1) {\n          let cqS = msg.indexOf('[CQ:image,')\n          let cqStr = msg.substring(cqS)\n          let cqE = cqStr.indexOf(']')\n          let CQ = cqStr.substring(0, cqE + 1)\n          if (CQ.indexOf('url') > -1) {\n            let urlS = CQ.indexOf('url=')\n            let urlStr = CQ.substring(urlS + 4)\n            let url = urlStr.substr(0, urlStr.indexOf('proxy=') > -1 ? urlStr.length - 9 : urlStr.length - 1)\n            // console.log(url)\n            let sp = url.split('.')\n            if ((sp.length > 1 && this.imgSuffix.some(o => sp[sp.length - 1].startsWith(o))) || url.indexOf('//gchat.qpic.cn/') > -1) {\n              url = urlPrefix + `xmbot/web/image.get?url=${url}`\n            }\n            msg = msg.replace(CQ, `<img class=\"display-block chat-item-img\" src=\"${url}\"/>`)\n          } else {\n            let fileS = CQ.indexOf('file=file:///')\n            let fileStr = CQ.substring(fileS + 13, CQ.length - 1)\n            let file = fileStr.substring(fileStr.indexOf('resource'))\n            console.log(fileStr, file)\n            let url = urlPrefix + 'xmbot/' + file.replaceAll('\\\\', '/')\n            msg = msg.replace(CQ, `<img class=\"display-block chat-item-img\" src=\"${url}\"/>`)\n          }\n          return this.imgFormat(msg, urlPrefix)\n        } else {\n          return msg\n        }\n      },\n      sendSubmit() {\n        if (this.textArea === '') {\n          this.inputErr = true\n          return\n        }\n        let receiver = this.activeTab.toLowerCase().split('-')\n        let reply = receiver[0] === 'group' ? 'group_id' : 'user_id'\n        const params = {message_type: receiver[0], message: this.textArea}\n        params[reply] = receiver[1]\n        this.$ajax({url: '/chat/sendMsg.do', method: 'post', data: params}).then(res => {\n          this.sendInit()\n        })\n      },\n      sendInit() {\n        this.textArea = ''\n      },\n      getMore() {\n        let split = this.activeTab.toLowerCase().split('-')\n        let params = {\n          type: split[0],\n          id: split[1],\n          index: this.chatLog[this.activeTab].rows[0].id\n        }\n        this.moreLoading = true\n        this.$ajax({url: '/chat/getMoreMsg.json', method: 'post', data: params})\n      }\n    },\n    created() {\n      if (this.$route.meta.auth) {\n        this.checkAuth()\n          .then(() => {\n            this.ws = this.$ws\n            this.getChatLog(this.$store.state.chatLog)\n            this.loading = false\n          })\n          .catch(err => {\n            this.$router.push('/index')\n            this.$destroy(this.$options.name)\n          })\n      } else\n        this.loading = false\n    }\n  }\n</script>\n\n<style scoped>\n  >>> .color-at {\n    color: #8cc5ff;\n  }\n\n  .chat-header {\n    box-shadow: inset 0 0 4px 1px #8c939d;\n    padding: 5px\n  }\n\n  .chat-box {\n    overflow: hidden;\n    box-shadow: inset 0 0 5px 1px #8c939d;\n    height: 790px;\n  }\n\n  .chat-box-tabs {\n    /*height: 800px;*/\n    /*overflow: auto;*/\n    position: relative;\n    box-shadow: inset 15px 0 8px -15px #8c939d;\n  }\n\n  .chat-box-content {\n    height: 560px;\n    overflow: auto;\n    padding: 15px 10px;\n    box-shadow: inset 0 -15px 8px -15px #8c939d;\n    position: relative;\n  }\n\n  .chat-box-more {\n    text-align: center;\n    font-size: 14px;\n    margin-bottom: 6px;\n  }\n\n  .chat-box-scroll {\n    position: absolute;\n    right: 30px;\n    font-size: 20px;\n    line-height: 36px;\n    height: 36px;\n    width: 36px;\n    text-align: center;\n    background-color: #fff;\n    cursor: pointer;\n    color: #409eff;\n    z-index: 999;\n    border-radius: 50%;\n    box-shadow: 0 0 6px rgba(0, 0, 0, .40);\n  }\n\n  .chat-box-scroll:hover {\n    background-color: #f2f6fc;\n  }\n\n  .scroll-to-top {\n    top: 5px;\n  }\n\n  .scroll-to-bottom {\n    top: 548px;\n  }\n\n  .chat-divider {\n    height: 10px;\n  }\n\n  .chat-box-input {\n    height: 180px;\n    box-shadow: inset 0 15px 8px -15px #8c939d;\n    padding: 10px;\n  }\n\n  .chat-box-input-btn {\n    padding: 8px 0;\n    text-align: right;\n    position: relative;\n  }\n\n  .chat-input-err {\n    color: red;\n    position: absolute;\n    left: 0;\n    top: 0;\n    font-size: 14px;\n    line-height: 24px;\n  }\n\n  .chat-input-textarea >>> textarea {\n    line-height: 20px;\n    font-family: \"Microsoft YaHei\", serif;\n  }\n\n  .chat-box-row, .chat-box-row-self {\n    padding: 5px;\n    margin-bottom: 5px;\n    border-radius: 5px;\n  }\n\n  .chat-box-row:hover {\n    box-shadow: 0 0 3px 3px #8c939d;\n  }\n\n  .chat-box-row-self:hover {\n    box-shadow: 0 0 3px 3px #8cc5ff;\n  }\n\n  .chat-item {\n    padding: 5px 10px;\n    box-shadow: 0 0 2px 1px #8c939d;\n    border-radius: 5px;\n    display: inline-block;\n    float: left;\n  }\n\n  .chat-item-self {\n    padding: 5px 10px;\n    box-shadow: 0 0 2px 1px #409EFF;\n    border-radius: 5px;\n    display: inline-block;\n    float: right;\n  }\n\n  .chat-item-title {\n    padding: 0 5px 2px 5px;\n    font-size: 14px;\n    display: inline-block;\n  }\n\n  .chat-item .chat-item-title {\n    box-shadow: 0 6px 6px -6px #8c939d;\n  }\n\n  .chat-item-self .chat-item-title {\n    box-shadow: 0 6px 6px -6px #409EFF;\n  }\n\n  .chat-item-user {\n    font-size: 16px;\n  }\n\n  .chat-item-time {\n    font-size: 14px;\n    vertical-align: bottom;\n    color: #8c939d;\n  }\n\n  .chat-item-content {\n    max-width: 500px;\n    margin: 5px 0 0 0;\n    padding: 0 5px;\n    line-height: 24px;\n  }\n\n  >>> .chat-item-img {\n    max-width: 500px;\n  }\n\n  .border-err >>> textarea {\n    border-color: red !important;\n  }\n\n  >>> .el-badge .el-badge__content {\n    top: 10px;\n    right: 5px;\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/others/socket-chat.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}]},[_c('el-row',{staticClass:\"text-center chat-header\"},[_c('el-link',{attrs:{\"type\":_vm.wsColor},on:{\"click\":_vm.wsConnect}},[_vm._v(_vm._s(_vm.wsStatus))])],1),_vm._v(\" \"),_c('div',{staticClass:\"chat-divider\"}),_vm._v(\" \"),(!_vm.loading)?_c('el-tabs',{staticClass:\"chat-box\",attrs:{\"tab-position\":\"left\"},model:{value:(_vm.activeTab),callback:function ($$v) {_vm.activeTab=$$v},expression:\"activeTab\"}},_vm._l((_vm.chatLog),function(val,key,index){return _c('el-tab-pane',{key:index,staticClass:\"chat-box-tabs\",attrs:{\"name\":key}},[_c('div',{attrs:{\"slot\":\"label\"},slot:\"label\"},[(val.newCount===0)?_c('span',[_vm._v(_vm._s(key))]):_c('el-badge',{staticStyle:{\"vertical-align\":\"top\"},attrs:{\"value\":val.newCount,\"max\":99}},[_c('span',[_vm._v(_vm._s(key))])])],1),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.curBox.scrollTop>200),expression:\"curBox.scrollTop>200\"}],staticClass:\"chat-box-scroll scroll-to-top\",on:{\"click\":function($event){return _vm.contentScroll(true)}}},[_c('i',{staticClass:\"el-icon-caret-top\"})]),_vm._v(\" \"),_c('div',{ref:\"chatBox\",refInFor:true,staticClass:\"chat-box-content\",on:{\"scroll\":_vm.scrollChange}},[_c('el-row',{staticClass:\"chat-box-more\"},[_c('el-link',{attrs:{\"type\":\"info\",\"disabled\":val.noMore},on:{\"click\":_vm.getMore}},[_vm._v(\"\\n            \"+_vm._s(val.noMore?'没有更多':'加载更多')+\"\\n          \")])],1),_vm._v(\" \"),_vm._l((val.rows),function(item,k){return _c('el-row',{key:k,class:item['is_self']?'chat-box-row-self':'chat-box-row'},[_c('div',{class:item['is_self']?'chat-item-self':'chat-item'},[_c('div',{class:item['is_self']?'text-right chat-item-title':'chat-item-title'},[_c('el-tooltip',{attrs:{\"content\":item.user_id,\"placement\":\"top\"}},[_c('el-link',{staticClass:\"chat-item-user\"},[_vm._v(_vm._s(item['nick_name']))])],1),_vm._v(\" \"),_c('span',{staticClass:\"chat-item-time\"},[_vm._v(\" [\"+_vm._s(_vm.dateFormat(item['send_time']))+\"]\")])],1),_vm._v(\" \"),_c('p',{staticClass:\"chat-item-content\",domProps:{\"innerHTML\":_vm._s(_vm.msgFormat(item.message))}})])])})],2),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.curBox.scrollHeight-_vm.curBox.scrollTop > _vm.curBox.height+200),expression:\"curBox.scrollHeight-curBox.scrollTop > curBox.height+200\"}],staticClass:\"chat-box-scroll scroll-to-bottom\",on:{\"click\":function($event){return _vm.contentScroll(false)}}},[_c('i',{staticClass:\"el-icon-caret-bottom\"})]),_vm._v(\" \"),_c('div',{staticClass:\"chat-divider\"}),_vm._v(\" \"),_c('div',{staticClass:\"chat-box-input\"},[_c('el-input',{class:_vm.inputErr?'chat-input-textarea border-err':'chat-input-textarea',attrs:{\"type\":\"textarea\",\"rows\":6,\"placeholder\":\"请输入内容\",\"maxlength\":\"250\",\"show-word-limit\":\"\"},nativeOn:{\"keypress\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }$event.preventDefault();return _vm.sendSubmit($event)},\"keydown\":[function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }if(!$event.altKey){ return null; }_vm.textArea += '\\n'},function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }if(!$event.ctrlKey){ return null; }_vm.textArea += '\\n'}]},model:{value:(_vm.textArea),callback:function ($$v) {_vm.textArea=$$v},expression:\"textArea\"}}),_vm._v(\" \"),_c('div',{staticClass:\"chat-box-input-btn\"},[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.inputErr),expression:\"inputErr\"}],staticClass:\"chat-input-err\"},[_vm._v(\"未输入内容\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\",\"icon\":\"el-icon-delete\"},on:{\"click\":_vm.sendInit}},[_vm._v(\"清空\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"icon\":\"el-icon-check\"},on:{\"click\":_vm.sendSubmit}},[_vm._v(\"发送\")])],1)],1)])}),1):_vm._e()],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7004fb92\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/others/socket-chat.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7004fb92\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./socket-chat.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./socket-chat.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./socket-chat.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7004fb92\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./socket-chat.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7004fb92\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/others/socket-chat.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}